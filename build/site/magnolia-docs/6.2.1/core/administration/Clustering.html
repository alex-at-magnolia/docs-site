<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Clustering - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/6.2.1/core/administration/Clustering.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2.1/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2.1/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2.1/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.1</button>
  <div class="version-menu">
    <a class="version is-current" href="Clustering.html">6.2.1</a>
    <a class="version is-missing" href="../../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="Clustering.html">Clustering - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="6.2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../releases/Releases.html">Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrade/Upgrading-to-Magnolia-6.2.x.html">Upgrading-to-Magnolia-6.2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#features/Features.adoc">Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/Magnolia-Cloud.html">Cloud</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../modules/Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Authoring.html">Authoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connector-packs/Connector_Packs.html">Connector Packs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../apps/Apps.html">Apps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/Magnolia-CLI.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../special-features/Special-Features.html">Special Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../support/Support.html">Need Support?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#FAQS.adoc">FAQs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">Clustering - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Administration.html" class="bare">Administration.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Administration.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="Instances.html">Instances</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196595681"><a class="anchor" href="#src-196595681"></a>Clustering</h2>
<div class="sectionbody">
<div id="main-content" class="paragraph">
<p>Related topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Community:
<a href="https://wiki.magnolia-cms.com/display/WIKI/Setting+up+a+Jackrabbit+Clustering">Setting
up a Jackrabbit Clustering</a></p>
</li>
<li>
<p>Jackrabbit: <a href="http://wiki.apache.org/jackrabbit/Clustering">Jackrabbit
Clustering</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="src-196595681_safe-id-Q2x1c3RlcmluZy1XaGF0aXNjbHVzdGVyaW5nPw"><a class="anchor" href="#src-196595681_safe-id-Q2x1c3RlcmluZy1XaGF0aXNjbHVzdGVyaW5nPw"></a>What is clustering?</h3>
<div class="paragraph">
<p>Magnolia can be configured to run in a clustered environment to provide
high availability and load balancing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>High-availability clusters</strong> are also known as fail-over clusters.
Their purpose is to ensure that content is served at all times. They
operate by having redundant instances which are used to provide service
when a public instance fails. The most common size for a
high-availability cluster is two public instances, the standard Magnolia
setup. In such a setup the redundant instance may even be dormant (not
actively serving content) until it is called to service.</p>
</li>
<li>
<p><strong>Load-balancing clusters</strong> connect many instances together to share the
workload. From a technical standpoint there are multiple instances but
from the website visitor&#8217;s perspective they function as a single virtual
instance. A load balancer distributes requests from visitors to
instances in the cluster. The result is a balanced computational
workload among different instances, improving the performance of the
site as a whole.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="src-196595681_Clustering-Conditionsforclustering"><a class="anchor" href="#src-196595681_Clustering-Conditionsforclustering"></a>Conditions for clustering</h3>
<div class="paragraph">
<p>If you consider to use clustering - make sure the following conditions
are true for your project and the environment you are running it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You are in full control of the virtual machines (VMs) on which the
cluster is running.</p>
</li>
<li>
<p>Your public instances are not treated as "disposable" with automatic
up/down scaling based on load<br>
OR<br>
Your public instances use the database (cluster) running on separate VM
that is not disposable.</p>
</li>
<li>
<p>The amount of writing (JCR) data is not too high.<br>
Reason:<br>
Each write action generates a record in the journal table that is used
to synchronize all cluster nodes - thus generating additional chatter
and load on each node (also due to sync of index).</p>
</li>
<li>
<p>You do not update Magnolia too frequently or do not require high
availability.<br>
(When updating clusters, all cluster nodes except one need to be
shutdown, and restarted with new libs after the first node was updated
successfully.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When above conditions are <em>not</em> met, it is in all likelihood better to
avoid using cluster and distribute data by other means instead.<br>
(For instance use REST services to write data directly from client or
using Magnolia Public instances as proxy writing to such externalized
service and being accessible from/via all instances).</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196595681_Clustering-Jackrabbitclustering"><a class="anchor" href="#src-196595681_Clustering-Jackrabbitclustering"></a>Jackrabbit clustering</h3>
<div class="paragraph">
<p>We use Jackrabbit&#8217;s clustering feature to share content between Magnolia
instances. Clustering in Jackrabbit works on the principle that content
is shared between all cluster nodes. This means that all Jackrabbit
cluster nodes need access to the same persistent storage (persistence
manager and <strong>data store</strong>). The persistence manager must be clusterable.
Any database is clusterable by its very nature as it stores content by
unique hash IDs. However, each cluster node needs its own (private) file
system and search index. For more details see
<a href="http://wiki.apache.org/jackrabbit/Clustering">Jackrabbit clustering
documentation</a>.</p>
</div>
<div class="paragraph">
<p>Individual <a href="Workspaces.html">workspaces</a> can be mapped to different
repositories. The repository that holds shared content can reside in
clustered storage. This is useful for content that needs to be in sync
across all instances.</p>
</div>
<div class="paragraph">
<p>In the diagram, each Magnolia instance uses its own persistent storage
for storing the content of <code>website</code>, <code>dam</code> and <code>config</code> workspaces.
However, the <code>comments</code> workspace has shared content that is stored in a
clustered storage, the database in the middle.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196595681/Clustering.png" alt="images/download/attachments/196595681/Clustering.png"></span></p>
</div>
<div class="paragraph">
<p>User generated content such as comments written by site visitors is a
typical clustering case. Imagine that users John and Jane request the
same web page. A load balancer redirects John to public instance A. When
John leaves a comment on the page, his comment is stored in a workspace
that resides in clustered storage. Now Jane requests the same page. The
load balancer redirects her to public instance B. John&#8217;s comment is
immediately visible to Jane since both instances tap into the same
clustered storage.</p>
</div>
<div class="paragraph">
<p>Other examples of shared content are user accounts, permissions of
public users and forum posts. They need to be available regardless of
the instance that serves the page.</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196595681_Clustering-CleaningtheJackrabbitjournal"><a class="anchor" href="#src-196595681_Clustering-CleaningtheJackrabbitjournal"></a>Cleaning the Jackrabbit journal</h3>
<div class="paragraph">
<p>Cluster nodes write their changes to a journal that can become very
large over time. By default, old revisions are not removed automatically
so that you could easily add new cluster nodes. Jackrabbit 1.5
introduced automatic cleaning of the database-based journal using a
process called Janitor.</p>
</div>
<div class="paragraph">
<p>To enable Janitor, see
<a href="http://wiki.apache.org/jackrabbit/Clustering#Removing_Old%20_Revisions">Removing
Old Revisions</a> and
<a href="http://blog.liip.ch/archive/2011/05/10/add-new-instances-to-your-jackrabbit-cluster-the-non-time-consuming-way.html">Add
new instances to your Jackrabbit cluster</a>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
Note the following about using Janitor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When Janitor is enabled you can no longer easily add cluster nodes,
but it is still possible.</p>
</li>
<li>
<p>All cluster nodes need to have written their local revision to the
database before the clean-up task runs for the first time.</p>
</li>
<li>
<p>If a cluster node is removed permanently, its entry in the
<code>LOCAL_REVISIONS</code> table should be removed manually.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Content staging</p>
</div>
<div class="paragraph">
<p>Data store deployment</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
