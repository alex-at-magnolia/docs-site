<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JCR persistence - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/6.2.1/core/modules/JCR_persistence.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../../magnolia-general/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.1</button>
  <div class="version-menu">
    <a class="version is-current" href="JCR_persistence.html">6.2.1</a>
    <a class="version is-missing" href="../../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="JCR_persistence.html">JCR persistence - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="6.2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../rn/release-notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/Magnolia-Cloud.html">Cloud</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Authoring.html">Authoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connector-packs/Connector_Packs.html">Connector Packs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#core/apps/apps.adoc">Apps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">JCR persistence - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Modules.html" class="bare">Modules.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Modules.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="">&#8230;&#8203;</a></p>
</li>
<li>
<p><a href="List_of_modules.html">List of modules</a></p>
</li>
<li>
<p><a href="Workflow_module.html">Workflow module</a></p>
</li>
<li>
<p><a href="jBPM_integration.html">jBPM integration</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196597508"><a class="anchor" href="#src-196597508"></a>JCR persistence</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="src-196597508_JCRpersistence-jBPMpersistence"><a class="anchor" href="#src-196597508_JCRpersistence-jBPMpersistence"></a>jBPM persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>jBPM implements a persistence layer based on JPA and Hibernate.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>jBPM allows the persistent storage of certain information. This chapter
describes these different types of persistence, and how to configure
them. An example of the information stored is the process runtime state.
Storing the process runtime state is necessary in order to be able to
continue execution of a process instance at any point, if something goes
wrong.&#8201;&#8212;&#8201;<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMPersistence.html">jBPM:
Persistence and Transactions</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In short the persistence allows shutting down the system and restoring
the state of all running processes upon restart.</p>
</div>
<div class="paragraph">
<p>In order to not have to set up a separate storage mechanism in Magnolia
for the jBPM engine, Magnolia provides its own JCR persistence layer for
jBPM.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jcr-persistence"><a class="anchor" href="#jcr-persistence"></a>JCR persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Magnolia stores all runtime data from the the jBPM engine in the
<code>workflow</code> workspace. By default workflow is only enabled on the author
instance.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597508/workflow_workspace.png" alt="images/download/attachments/196597508/workflow_workspace.png"></span></p>
</div>
<div class="paragraph">
<p>jBPM stores most of the data used for its execution as binary data using
marshalling mechanisms. This makes the underlaying scheme rather simple.</p>
</div>
<div class="sect2">
<h3 id="src-196597508_JCRpersistence-Session"><a class="anchor" href="#src-196597508_JCRpersistence-Session"></a>Session</h3>
<div class="paragraph">
<p>As we are using the
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMCoreEngine.html#d0e1975">singleton
strategy</a> for our runtime engine we are only dealing with one session.
This session is stored under the <code>sessions</code> node with <code>0</code> as static
identifier and is never removed. All data is marshalled into the binary
property <code>bytes</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597508/Screen_Shot_2014-03-21_at_10.50.25.png" alt="images/download/attachments/196597508/Screen_Shot_2014-03-21_at_10.50.25.png"></span></p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>The session ID is not using the key generator Magnolia uses for storing
processes and workItems. One reason is that by using the singleton
strategy this is not necessary at the moment at least. Another reason
ist that the interfaces and implementation classes used inside the jBPM
persistence package is restricted to use integers as IDs, compared to
processInstances and workItems using a long.</p>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-Marshalling"><a class="anchor" href="#src-196597508_JCRpersistence-Marshalling"></a>Marshalling</h4>
<div class="paragraph">
<p>The marshalling is done inside the SessionInfo&#8217;s update method, which is
an object used and created by the CommandService.</p>
</div>
<div class="paragraph">
<p>SimpleSessionCommandService</p>
</div>
<div class="paragraph">
<p><code>protected<code> </code>void`</code> initNewKnowledgeSession(KieBase kbase, KieSessionConfiguration conf) {`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.sessionInfo = <code>new</code> SessionInfo();`</p>
</div>
<div class="paragraph">
<p>`      &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.marshallingHelper = <code>new</code> SessionMarshallingHelper( <code>this</code>.ksession, conf );`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.sessionInfo.setJPASessionMashallingHelper( <code>this</code>.marshallingHelper );`</p>
</div>
<div class="paragraph">
<p>`      &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.commandService = <code>new</code> TransactionInterceptor(kContext);`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p>SessionInfo</p>
</div>
<div class="paragraph">
<p>`    <code>public</code> <code>void</code> update() {`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.rulesByteArray  = <code>this</code>.helper.getSnapshot();`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-SessionStore"><a class="anchor" href="#src-196597508_JCRpersistence-SessionStore"></a>SessionStore</h4>
<div class="paragraph">
<p>Persisting the SessionInfo is handled by the <code>JcrSessionStore</code>
implementation in <code>SystemContextSessionStore</code> where all operations are
performed in Magnolia&#8217;s <code>SystemContext</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196597508_JCRpersistence-ProcessInstance"><a class="anchor" href="#src-196597508_JCRpersistence-ProcessInstance"></a>ProcessInstance</h3>
<div class="paragraph">
<p>Processes are stored under the <code>processInstances</code> node inside the
<code>workflow</code> workspace. As this data is used during the actual execution
of processes, the data is removed when the process terminates.
Magnolia&#8217;s current implementation does not support logging completed
processes for further auditing. For more information how this could be
implemented, see the documentation of
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMPersistence.html#d0e4482">jBPM
Audit data model</a>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597508/Screen_Shot_2014-03-21_at_12.29.16.png" alt="images/download/attachments/196597508/Screen_Shot_2014-03-21_at_12.29.16.png"></span></p>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-Keygenerator"><a class="anchor" href="#src-196597508_JCRpersistence-Keygenerator"></a>Key generator</h4>
<div class="paragraph">
<p>For creating the IDs for process instances we use the
<code>ProcessInstanceIdGenerator</code> which creates a Long from the current
system time. The processes are further stored hierarchical based on
year, month of year and day of month.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-Marshalling.1"><a class="anchor" href="#src-196597508_JCRpersistence-Marshalling.1"></a>Marshalling</h4>
<div class="paragraph">
<p>Similar to the sessions, the processes use a marshalling mechanism and
most of the runtime data is stored as a binary under the bytes property.
The marshalling is performed inside ProcessInstanceInfo&#8217;s update method.
The info object is created by <code>JcrProcessInstanceManager</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-ProcessInstanceStore"><a class="anchor" href="#src-196597508_JCRpersistence-ProcessInstanceStore"></a>ProcessInstanceStore</h4>
<div class="paragraph">
<p>Persisting the ProcessInstanceInfo is handled by the <code>JcrProcessStore</code>
implementation in <code>SystemContextProcessStore</code> where all operations are
performed in Magnolia&#8217;s <code>SystemContext</code>. Because we do not need the
<code>correlation key</code> used for mapping sessions to processInstances due to
the <code>singleton strategy</code>, those methods are currently not implemented.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196597508_JCRpersistence-Workitem"><a class="anchor" href="#src-196597508_JCRpersistence-Workitem"></a>Workitem</h3>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597508/Screen_Shot_2014-03-21_at_13.36.13.png" alt="images/download/attachments/196597508/Screen_Shot_2014-03-21_at_13.36.13.png"></span></p>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-Keygenerator.1"><a class="anchor" href="#src-196597508_JCRpersistence-Keygenerator.1"></a>Key generator</h4>
<div class="paragraph">
<p>Workitems are using the same hierarchical structure and keys as the
processInstances. The key generator used is implemented in
<code>WorkItemIdGenerator</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-Marshalling.2"><a class="anchor" href="#src-196597508_JCRpersistence-Marshalling.2"></a>Marshalling</h4>
<div class="paragraph">
<p>The marshalling of work items happens in the update method of the
<code>WorkItemInfo</code> object and the binary data is stored under the <code>bytes</code>
property.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-WorkItemStore"><a class="anchor" href="#src-196597508_JCRpersistence-WorkItemStore"></a>WorkItemStore</h4>
<div class="paragraph">
<p>Persisting the WorkItemInfo is handled by the <code>JcrWorkItemStore</code>
implementation in <code>SystemContextWorkitemStore</code> where all operations are
performed in Magnolia&#8217;s <code>SystemContext</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196597508_JCRpersistence-Safepoints"><a class="anchor" href="#src-196597508_JCRpersistence-Safepoints"></a>Safe points</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Contrary to the simple storage scheme finding the right spots to persist
the current state of a process is a bit more tricky. These spots are
called
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMPersistence.html#d0e4042">safe
points</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The state of a process instance is stored at so-called "safe points"
during the execution of the process engine. Whenever a process instance
is executing (for example when it started or continuing from a previous
wait state, the engine executes the process instance until no more
actions can be performed (meaning that the process instance either has
completed (or was aborted), or that it has reached a wait state in all
of its parallel paths). At that point, the engine has reached the next
safe state, and the state of the process instance (and all other process
instances that might have been affected) is stored persistently. –
<a href="http://docs.jboss.org/jbpm/v5.3/userguide/ch.core-persistence.html#d0e3587">jBPM:
Safe Points</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>These safe points are reached by different classes. Some of of the logic
is taken care of by the <code>ProcessInstanceManager</code> and <code>WorkItemManager</code>
where the state is persisted when the execution starts or is completed.
As this is not sufficient for keeping the persisted state updated at all
times we hook into the internal execution of a process with the
<code>CommandService</code>.</p>
</div>
<div class="sect2">
<h3 id="src-196597508_JCRpersistence-CommandService"><a class="anchor" href="#src-196597508_JCRpersistence-CommandService"></a>CommandService</h3>
<div class="paragraph">
<p>To persist the processes at safe points, Magnolia uses a CommandService
which allows intercepting internally used Commands.</p>
</div>
<div class="paragraph">
<p>When loading or creating a <code>KieSession</code> by the <code>JcrSessionFactory</code> it
delegates the creation to <code>JcrKieStoreServices</code> which in turn creates a
<code>CommandBasedStatefulKnowledgeSession</code>, an implementation of the
<code>KieSession</code> creating Commands for each step of the process.</p>
</div>
<div class="paragraph">
<p>As an example this is how the <code>CommandBasedStatefulKnowledgeSession</code>
starts a process by creating a <code>StartProcessCommand</code> containing the
processId and the parameters. You also see how the actual execution of
the command is delegated to the <code>commandService</code>.</p>
</div>
<div class="paragraph">
<p><code>&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>`    <code>public</code> ProcessInstance startProcess(String processId, Map&lt;String, Object&gt; parameters) {`</p>
</div>
<div class="paragraph">
<p>`        StartProcessCommand command = <code>new</code> StartProcessCommand();`</p>
</div>
<div class="paragraph">
<p>`        command.setProcessId( processId );`</p>
</div>
<div class="paragraph">
<p>`        command.setParameters( parameters );`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> commandService.execute( command );`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>When not using the <code>CommandBasedStatefulKnowledgeSession</code> this would
create a <code>ProcessInstance</code> and directly start it.</p>
</div>
<div class="sect3">
<h4 id="src-196597508_JCRpersistence-Interceptors"><a class="anchor" href="#src-196597508_JCRpersistence-Interceptors"></a>Interceptors</h4>
<div class="paragraph">
<p>The interceptors used for persisting the state are registered by the
<code>JcrSessionFactory</code> to the <code>commandService</code>.</p>
</div>
<div class="paragraph">
<p>The concept behind these interceptors is rather simple. They act as
CommandExecutors for commands and allow adding custom logic before and
after executing the command. As an example let&#8217;s take a look at the
<code>JcrPersistProcessInterceptor</code> which takes care of persisting
ProcessInstances.</p>
</div>
<div class="paragraph">
<p>JcrPersistProcessInterceptor</p>
</div>
<div class="paragraph">
<p>`    `</p>
</div>
<div class="paragraph">
<p>`    <code>public</code> JcrPersistProcessInterceptor(SimpleSessionCommandService interceptedService) {`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.interceptedService = interceptedService;`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p>`  <code>`@Override</code></p>
</div>
<div class="paragraph">
<p>`    <code>public</code> &lt;T&gt; T execute(Command&lt;T&gt; command) {`</p>
</div>
<div class="paragraph">
<p>`        T result = <code>null</code>;`</p>
</div>
<div class="paragraph">
<p>`        <code>try</code> {`</p>
</div>
<div class="paragraph">
<p>`            result = executeNext(command);`</p>
</div>
<div class="paragraph">
<p>`      }`</p>
</div>
<div class="paragraph">
<p>`      &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`        <code>if</code> (isValidCommand(command)) {`</p>
</div>
<div class="paragraph">
<p>`            executeNext(<code>new</code> PersistProcessCommand(jpm, ksession));`</p>
</div>
<div class="paragraph">
<p>`        }`</p>
</div>
<div class="paragraph">
<p>`      &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`  }`</p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p>`    <code>protected</code> <code>boolean</code> isValidCommand(Command&lt;?&gt; command) {`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> (command <code>instanceof</code> StartProcessCommand) ||`</p>
</div>
<div class="paragraph">
<p>`                (command <code>instanceof</code> CreateProcessInstanceCommand) ||`</p>
</div>
<div class="paragraph">
<p>`                &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`                (command <code>instanceof</code> FireAllRulesCommand);`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>Note how the interceptor creates and executes a <code>PersistProcessCommand</code>
in case the Command met the criteria of <code>isValidCommand(command)</code>.
Persisting the ProcessInstance is then taken care of by the
PersistProcessCommand.</p>
</div>
<div class="paragraph">
<p>PersistProcessCommand</p>
</div>
<div class="paragraph">
<p>`    <code>public</code> PersistProcessCommand(Object jpm, KieSession ksession) {`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.persistenceContext = ((ProcessPersistenceContextManager) jpm).getProcessPersistenceContext();`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>.ksession = ksession;`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>`    <code>`@Override</code></p>
</div>
<div class="paragraph">
<p>`    <code>public</code> Void execute(Context context) {`</p>
</div>
<div class="paragraph">
<p>`      &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`        ProcessInstanceInfo info = <code>new</code> ProcessInstanceInfo(instance, ksession.getEnvironment());`</p>
</div>
<div class="paragraph">
<p>`        info.setId(instance.getId());`</p>
</div>
<div class="paragraph">
<p>`        info.update();`</p>
</div>
<div class="paragraph">
<p>`        persistenceContext.persist(info);`</p>
</div>
<div class="paragraph">
<p>`        &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`     } `</p>
</div>
<div class="paragraph">
<p>A similar interceptor is used for persisting the session state.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196597508_JCRpersistence-JCRpersistencediagram"><a class="anchor" href="#src-196597508_JCRpersistence-JCRpersistencediagram"></a>JCR persistence diagram</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This diagram shows the most important classes used for persisting
sessions, workitems and processes to JCR.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597508/UML_peristence.png" alt="images/download/attachments/196597508/UML_peristence.png"></span></p>
</div>
<div class="paragraph">
<p>jBPM runtime</p>
</div>
<div class="paragraph">
<p>Light modules</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
