<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Groovy module - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/6.2.1/core/modules/Groovy_module.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../../magnolia-general/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.1</button>
  <div class="version-menu">
    <a class="version is-current" href="Groovy_module.html">6.2.1</a>
    <a class="version is-missing" href="../../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="Groovy_module.html">Groovy module - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="6.2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../rn/release-notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/dump/Magnolia-Cloud.html">Dump Index</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">Groovy module - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Modules.html" class="bare">Modules.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Modules.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="List_of_modules.html">List of modules</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196597001"><a class="anchor" href="#src-196597001"></a>Groovy module</h2>
<div class="sectionbody">
<table id="main-content" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Edition</th>
<th class="tableblock halign-left valign-top">CE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.magnolia-cms.com/mla">MLA</a>,
<a href="http://www.gnu.org/licenses/gpl.html">GPL</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://jira.magnolia-cms.com/browse/MGNLGROOVY">MGNLGROOVY</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maven site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://nexus.magnolia-cms.com/content/sites/magnolia.public.sites/modules/magnolia-module-groovy/">Groovy</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.8.2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Magnolia Groovy module adds Groovy capabilities to Magnolia. Groovy is a
popular dynamic language for the JVM. To know more about it, please
visit the <a href="http://www.groovy-lang.org/">Groovy official website</a> which has
plenty of tutorials and excellent documentation both for beginners and
advanced users of the language.</p>
</div>
<div class="paragraph">
<p>The module provides a web based Unix-like console where you can access
contents in Magnolia repositories in a "groovish" way, a <code>scripts</code>
repository where you can store your scripts and the ability to plugin
Groovy classes into Magnolia at runtime, without the need for deploying
them and restarting the servlet container. All these tools make for a
more agile approach to coding and maintaining Magnolia based websites.</p>
</div>
<div class="sect2">
<h3 id="src-196597001_Groovymodule-Installing"><a class="anchor" href="#src-196597001_Groovymodule-Installing"></a>Installing</h3>
<div class="paragraph">
<p>Maven is the easiest way to install the module. Add the following to
your
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Bundles+and+webapps">bundle</a>:</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Note the changes in <code>groupId</code> and <code>artifactId</code> since the 2.6 release.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;info.magnolia.groovy&lt;/groupId&gt;
  &lt;artifactId&gt;magnolia-groovy&lt;/artifactId&gt;
  &lt;version&gt;3.0&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-Compatibilitymodule"><a class="anchor" href="#src-196597001_Groovymodule-Compatibilitymodule"></a>Compatibility module</h4>
<div class="paragraph">
<p>We have been gradually removing the old Content API from our modules
since Magnolia 5.6. If you have custom code relying on classes from the
old groovy module then you must do one of two things:</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>If you have Groovy scripts or classes which rely on the Content API,
then you will need the compatibility module to run them. You are
encouraged to update to Node API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Update your code for the
<a href="https://jira.magnolia-cms.com/browse/MGNLGROOVY-163">new version of the
groovy module</a>.</p>
</li>
<li>
<p>Or you can use the <code>magnolia-groovy-compatibility</code> module together
with the <code>magnolia-core-compatibility</code> module.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click here to expand to see how to add the compatibility module</p>
</div>
<div class="paragraph">
<p>Add the following snippet to you pom file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;info.magnolia.groovy&lt;/groupId&gt;
  &lt;artifactId&gt;magnolia-groovy-compatibility&lt;/artifactId&gt;
  &lt;version&gt;2.8.2&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196597001_Groovymodule-Usage"><a class="anchor" href="#src-196597001_Groovymodule-Usage"></a>Usage</h3>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-Repositorydatanavigationsimplified"><a class="anchor" href="#src-196597001_Groovymodule-Repositorydatanavigationsimplified"></a>Repository data navigation simplified</h4>
<div class="paragraph">
<p>Thanks to the . <em>(dot)</em> notation and other handy shortcuts such as
<code>.nodes</code> (alternatively <code>.children</code>), <code>.properties</code>, <code>.metaData</code> and
<code>.parent</code> you can read any content node and property, change their
values, create nodes and delete them, all with clean, concise syntax.
The module is shipped with some preinstalled scripts that demonstrate
most of these features. As an example, here is how to navigate to and
print the node data named <code>title</code>:</p>
</div>
<div class="paragraph">
<p><code>session = ctx.getJCRSession(<code>'website'</code>)</code></p>
</div>
<div class="paragraph">
<p><code>node = session.getNode(<code>'/travel'</code>)</code></p>
</div>
<div class="paragraph">
<p><code>node.about.title</code></p>
</div>
<div class="paragraph">
<p>One noticeable thing about the above snippet is that it is all you need
to write: no imports, no need to catch exceptions, etc. Compare it to
the Java code that achieves the same result.</p>
</div>
<div class="paragraph">
<p><code>import`</code> info.magnolia.context.MgnlContext;`</p>
</div>
<div class="paragraph">
<p><code>import`</code> javax.jcr.Node;`</p>
</div>
<div class="paragraph">
<p><code>import`</code> javax.jcr.RepositoryException;`</p>
</div>
<div class="paragraph">
<p><code>import`</code> javax.jcr.Session;`</p>
</div>
<div class="paragraph">
<p><code>public<code> </code>class`</code> Test {`</p>
</div>
<div class="paragraph">
<p>`    <code>public</code> <code>static</code> <code>void</code> main(String[] args) {`</p>
</div>
<div class="paragraph">
<p>`        <code>try</code> {`</p>
</div>
<div class="paragraph">
<p>`            Session session = MgnlContext.getJCRSession(<code>"website"</code>);`</p>
</div>
<div class="paragraph">
<p>`            Node node = session.getNode(<code>"/travel/about"</code>);`</p>
</div>
<div class="paragraph">
<p>`            String value = node.getProperty(<code>"title"</code>).getString();`</p>
</div>
<div class="paragraph">
<p>`            System.out.println(value);`</p>
</div>
<div class="paragraph">
<p>`        } <code>catch</code> (RepositoryException e) {`</p>
</div>
<div class="paragraph">
<p>`            e.printStackTrace();`</p>
</div>
<div class="paragraph">
<p>`        }`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p>And, most importantly, with Groovy you do not need to deploy your class
and restart the server. As an additional bonus, when using the Groovy
Unix-like shell which comes with the module, when you navigate a
repository, by calling the <code>print()</code> method on a node its children and
properties are shown in the output, giving you an overview of the data
structure. The screenshot below illustrates this.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Using the <code>print()</code> method differs from previous versions where the data
structure was displayed automatically on pressing the Enter key.
However, in many cases that caused the output to be unnecessarily
verbose. What is printed now by default is simply the node path.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597001/6-1-groovyModule.png" alt="images/download/attachments/196597001/6-1-groovyModule.png"></span></p>
</div>
<div class="paragraph">
<p>Being able to navigate a repository data like this can come in handy,
for instance, when writing and testing your own scripts or trying things
out. Or when you need to use the
<a href="#src-196597001_Groovymodule-RescueApp">Rescue App</a> because the
Magnolia UI, for whatever reason, is not available.</p>
</div>
<div class="paragraph">
<p>As <code>node</code> here is basically an instance of a JCR
<a href="http://www.day.com/maven/javax.jcr/javadocs/jcr-2.0/javax/jcr/Node.html">Node</a>
coated in a special "groovysh" wrapper, you to call any of the Node
interface methods and take advantage of the Groovy goodies at the same
time.</p>
</div>
<div class="paragraph">
<p>`node.about.properties.each { println it.name } `</p>
</div>
<div class="paragraph">
<p><code>println node.about.parent `</code>//(this can be null)`</p>
</div>
<div class="paragraph">
<p>If you want to print out all node properties but <em>jcr</em> ones, you can do:</p>
</div>
<div class="paragraph">
<p><code>node.about.properties.findAll { !it.name.startsWith(<code>'jcr:'</code>) }.each{ println it.name }</code></p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-Built-inHelp"><a class="anchor" href="#src-196597001_Groovymodule-Built-inHelp"></a>Built-in Help</h4>
<div class="paragraph">
<p>Type <code>help</code> (or <code>?</code>) followed by Enter to view the built-in help
(including keyboard shortcuts) for the Groovy shell.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-KeyboardShortcuts"><a class="anchor" href="#src-196597001_Groovymodule-KeyboardShortcuts"></a>Keyboard Shortcuts</h4>
<div class="paragraph">
<p>The <code>ctx</code> context object is always available. In Groovy it represents
<code>MgnlGroovyConsoleContext</code>, a special instance of Magnolia&#8217;s <code>Context</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Binding</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TAB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger autocompletion of variables names and object methods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TAB</strong> <strong>TAB</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discover all available suggestions, if any, for the
current identifier or script context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SHIFT</strong> + <strong>ENTER</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activate multi-line mode in the console. To run the
code, hit the <strong>ENTER</strong> key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>↑</strong> or <strong>CTRL</strong> + <strong>P</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show previous command from history</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>↓</strong> or <strong>CTRL</strong> + <strong>N</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show next command from history.
<span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
<strong>CTRL</strong> + <strong>N</strong> on MacOS only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CTRL</strong> + <strong>R</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Begin reverse search through history. Type characters to
find matching commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Esc</strong> or <strong>CTRL</strong> + <strong>G</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cancel reverse search</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>←</strong> or <strong>CTRL</strong> + <strong>B</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move cursor one character left</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>→</strong> or <strong>CTRL</strong> + <strong>F</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move cursor one character right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HOME</strong> or <strong>CTRL</strong> + <strong>A</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move to beginning of line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>END</strong> or <strong>CTRL</strong> + <strong>E</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Move to end of line</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-Createandupdateproperties"><a class="anchor" href="#src-196597001_Groovymodule-Createandupdateproperties"></a>Create and update properties</h4>
<div class="paragraph">
<p>It is also possible to assign values to properties or create new ones.</p>
</div>
<div class="paragraph">
<p><code>node.foo = <code>3</code>.14d</code></p>
</div>
<div class="paragraph">
<p><code>node.bar = ``true</code></p>
</div>
<div class="paragraph">
<p><code>node.baz = `&#8217;some text'</code></p>
</div>
<div class="paragraph">
<p><code>node.qux = ``100</code></p>
</div>
<div class="paragraph">
<p>This will assign the values on the right hand side to the properties on
left hand side. Should those not exist, they will be automatically
created. Moreover, the correct type will be detected based on the value
assigned (<code>Boolean</code>, <code>String</code>, <code>Long</code> or <code>Double</code>).</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>All the above assignments will be in-memory only unless explicitly
persisted via a call to <code>save()</code> on the current JCR session.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-UseGroovyclassesinsteadofJavaclasses"><a class="anchor" href="#src-196597001_Groovymodule-UseGroovyclassesinsteadofJavaclasses"></a>Use Groovy classes instead of Java classes</h4>
<div class="paragraph">
<p>This feature allows you to virtually replace every Magnolia Java class
with a Groovy one. Although not a major issue for most tasks, <strong>due to
its dynamic nature Groovy is slower than Java on the first run</strong>. This
because groovy code must be compiled into byte-code before it can be ran
on the JVM. Nevertheless, replacing classes can come in handy in
situations where you cannot deploy and restart the server, but need to
quickly fix or add a piece of logic.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Two <a href="http://ant.apache.org/">Apache Ant</a> version 1.9.2 jars are required
to test this example.
<a href="http://archive.apache.org/dist/ant/binaries/apache-ant-1.9.2-bin.zip">Download
Ant 1.9.2</a> and extract the files. Add <code>ant.jar</code> and <code>ant-launcher.jar</code>.
to your file system at
<code>/&lt;CATALINA_HOME&gt;/webapps/&lt;contextPath&gt;/WEB-INF/lib</code> and restart
Magnolia`.`</p>
</div>
<div class="paragraph">
<p>The Groovy module ships with a sample class
<code>sample.commands.GroovyMailCommand</code> that sends an email. Here is how you
could use it to create a new scheduled job on-the-fly using a Groovy
command and the <a href="Scheduler_module.html">Scheduler module</a>.</p>
</div>
<div class="paragraph">
<p>The <code>GroovyMailCommand</code> is accessible in <strong>Dev &gt; Groovy</strong>
<code>/samples/commands/GroovyMailCommand</code>.</p>
</div>
<div class="paragraph">
<p>GroovyMailCommand</p>
</div>
<div class="paragraph">
<p><code>package`</code> samples.commands`</p>
</div>
<div class="paragraph">
<p><code>import`</code> info.magnolia.commands.*`</p>
</div>
<div class="paragraph">
<p><code>/*</code></p>
</div>
<div class="paragraph">
<p><code>* This groovy class is an example that serves to show how it can be used as a replacement of a traditional Java class on the fly.</code></p>
</div>
<div class="paragraph">
<p><code>*/</code></p>
</div>
<div class="paragraph">
<p><code>public<code> </code>class<code> GroovyMailCommand </code>extends`</code> MgnlCommand {`</p>
</div>
<div class="paragraph">
<p>`    <code>public</code> <code>boolean</code> execute(Context ctx) {`</p>
</div>
<div class="paragraph">
<p>`        def ant = <code>new</code> AntBuilder()`</p>
</div>
<div class="paragraph">
<p>`        def buildname = ctx.get(<code>'buildname'</code>)`</p>
</div>
<div class="paragraph">
<p>`        ant.mail(mailhost:<code>'mailhost'</code>, mailport:<code>'25'</code>, subject: ctx.get(<code>'subject'</code>)) {`</p>
</div>
<div class="paragraph">
<p>`           from(address:ctx.get(<code>'from'</code>))`</p>
</div>
<div class="paragraph">
<p>`           to(address:ctx.get(<code>'to'</code>))`</p>
</div>
<div class="paragraph">
<p>`           message(<code>"The ${buildname} nightly build has completed"</code>)`</p>
</div>
<div class="paragraph">
<p>`        }`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
Replace <code>mailhost</code> with your SMTP server address.</p>
</div>
<div class="paragraph">
<p>Create a command configuration in the <strong>Configuration</strong> app as shown
below. We added it to the Mail module in
<code>/modules/mail/commands/default</code>, but you can add it to your own module
or another of your choice. Specify the fully qualified name of the
Groovy class (matching the path in the repository where it is saved
<code>samples.commands</code>) as if it were a plain Java class (which it actually
is).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mail</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">commands</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendMail</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendMailWithGroovy</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">samples.commands.GroovyMailCommand</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Create a scheduled job configuration referring to the command in the
<strong>Configuration</strong> app &gt; <code>/modules/scheduler/config/jobs</code>. The parameters
will be used at runtime by the Groovy script.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scheduler</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobs</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">demo</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendMail</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">params</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TEST123</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:me@me.com">me@me.com</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hello</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:you@you.com">you@you.com</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">catalog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sendMailWithGroovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cron</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 0 * * * *</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">send mail every hour</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Replace the <code>from</code> and <code>to</code> email addresses with actual addresses.</p>
</div>
<div class="paragraph">
<p>You can use this command to replace a similar Java command at runtime.
Or you can edit it and have it compiled and replaced on-the-fly (a kind
of class hot deploy). This relies on the Magnolia observation mechanism.
Every time the value of the <code>class</code> node data changes the Groovy class
will be recompiled.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597001_Groovymodule-RescueApp"><a class="anchor" href="#src-196597001_Groovymodule-RescueApp"></a>Rescue App</h4>
<div class="paragraph">
<p>The <code>MgnlGroovyRescueApp</code> is a special Vaadin app that can be used to
bypass the Magnolia filter chain. This is useful when you need to
perform rescue operations on a corrupted Magnolia instance or when the
Magnolia UI is not loading. To enable the servlet you must explicitly
comment out the Magnolia filter chain in the <code>web.xml</code> file and register
the Groovy Rescue App.</p>
</div>
<div class="paragraph">
<p>All operations performed in the Groovy Rescue App are executed in system
context, meaning no security restrictions are enforced. This might
expose your data to risk of irreversible damages if you are not aware of
what you are doing. In other words, <strong>use it at your own risk</strong>.</p>
</div>
<div class="sect4">
<h5 id="src-196597001_Groovymodule-RegistertheGroovyRescueApp"><a class="anchor" href="#src-196597001_Groovymodule-RegistertheGroovyRescueApp"></a>Register the Groovy Rescue App</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop Magnolia</p>
</li>
<li>
<p>Open <code>/&lt;CATALINA_HOME&gt;/webapps/&lt;contextPath&gt;/WEB-INF/web.xml</code> in a
text editor.</p>
</li>
<li>
<p>Comment out the <code>filter</code> and <code>filter-mapping</code> sections:</p>
<div class="paragraph">
<p><code>&lt;!--</code></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>&lt;filter&gt;</code></p>
</div>
<div class="paragraph">
<p>`   &lt;display-name&gt;Magnolia global filters&lt;/display-name&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;filter-name&gt;magnoliaFilterChain&lt;/filter-name&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;filter-<code>class</code>&gt;info.magnolia.cms.filters.MgnlMainFilter&lt;/filter-<code>class</code>&gt;`</p>
</div>
<div class="paragraph">
<p><code>&lt;/filter&gt;</code></p>
</div>
<div class="paragraph">
<p><code>&lt;filter-mapping&gt;</code></p>
</div>
<div class="paragraph">
<p>`   &lt;filter-name&gt;magnoliaFilterChain&lt;/filter-name&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;url-pattern&gt;/*&lt;/url-pattern&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;`</p>
</div>
<div class="paragraph">
<p><code>&lt;/filter-mapping&gt;</code></p>
</div>
<div class="paragraph">
<p><code>-&#8594;</code>
. Add the following lines to web.xml in order to register the Groovy
Rescue App:</p>
</div>
<div class="paragraph">
<p>+
<code>&lt;servlet&gt;</code></p>
</div>
<div class="paragraph">
<p><code>&lt;servlet-name&gt;Vaadin&lt;/servlet-name&gt;</code></p>
</div>
<div class="paragraph">
<p>`  &lt;servlet-<code>class</code>&gt;com.vaadin.server.VaadinServlet&lt;/servlet-<code>class</code>&gt;`</p>
</div>
<div class="paragraph">
<p>`    &lt;init-param&gt;`</p>
</div>
<div class="paragraph">
<p>`      &lt;description&gt;Groovy Rescue App&lt;/description&gt;`</p>
</div>
<div class="paragraph">
<p>`      &lt;param-name&gt;UI&lt;/param-name&gt;`</p>
</div>
<div class="paragraph">
<p>`      &lt;param-value&gt;info.magnolia.module.groovy.rescue.MgnlGroovyRescueApp&lt;/param-value&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;/init-param&gt;`</p>
</div>
<div class="paragraph">
<p>`   &lt;init-param&gt;`</p>
</div>
<div class="paragraph">
<p>`      &lt;param-name&gt;widgetset&lt;/param-name&gt;`</p>
</div>
<div class="paragraph">
<p><code>&lt;!--      &lt;param-value&gt;info.magnolia.widgetset.MagnoliaWidgetSet&lt;/param-value&gt; -&#8594;</code></p>
</div>
<div class="paragraph">
<p><code>&lt;!--      &lt;param-value&gt;info.magnolia.widgetset.MagnoliaProWidgetSet&lt;/param-value&gt; -&#8594;</code></p>
</div>
<div class="paragraph">
<p>`   &lt;/init-param&gt;&lt;/servlet&gt;`</p>
</div>
<div class="paragraph">
<p><code>&lt;servlet-mapping&gt;</code></p>
</div>
<div class="paragraph">
<p>`  &lt;servlet-name&gt;Vaadin&lt;/servlet-name&gt;`</p>
</div>
<div class="paragraph">
<p>`  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;`</p>
</div>
<div class="paragraph">
<p><code>&lt;/servlet-mapping&gt;</code>
. Uncomment:
* <code>&lt;param-value&gt;info.magnolia.widgetset.MagnoliaWidgetSet&lt;/param-value&gt;</code>
- when using Magnolia CE.
* <code>&lt;param-value&gt;info.magnolia.widgetset.MagnoliaProWidgetSet&lt;/param-value&gt;</code>
- when using DX Core.
. Save the web.xml.
. Start Magnolia.
. Open a Web browser and access the Groovy Rescue App at
<code><a href="http://host/&lt;contextPath&gt" class="bare">http://host/&lt;contextPath&gt</a>;</code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597001/rescue-app.png" alt="images/download/attachments/196597001/rescue-app.png"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="src-196597001_Groovymodule-Maketherequiredchanges"><a class="anchor" href="#src-196597001_Groovymodule-Maketherequiredchanges"></a>Make the required changes</h5>
<div class="paragraph">
<p>Use Groovy commands to navigate to the data you want to change.</p>
</div>
<div class="paragraph">
<p><strong>Example 1</strong>: Deleting an erroneous configuration node <code>untitled</code> from
<code>/config/modules/someModule/virtualURIMapping</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Assign <code>Session</code> of <code>config</code> repository to <code>session</code>.</p>
<div class="paragraph">
<p><code>session = ctx.getJCRSession(<code>'config'</code>)</code></p>
</div>
</li>
<li>
<p>Assign the parent node content to <code>root</code>.</p>
<div class="paragraph">
<p><code>root = session.getNode(<code>'/modules/someModule/virtualURIMapping/'</code>)</code></p>
</div>
</li>
<li>
<p>Get and remove the child node <code>untitled</code>.</p>
<div class="paragraph">
<p><code>root.getNode(<code>'untitled'</code>).remove()</code></p>
</div>
</li>
<li>
<p>Save the session.</p>
<div class="paragraph">
<p><code>session.save()</code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
Always remember to save the session after modifying a node.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example 2</strong>: Disabling the <code>I18nContentSupportFilter</code> filter.</p>
</div>
<div class="paragraph">
<p><code>mgnl&gt; session = ctx.getJCRSession(<code>'config'</code>)</code></p>
</div>
<div class="paragraph">
<p><code>===&#8658; session-admin-``213</code></p>
</div>
<div class="paragraph">
<p><code>mgnl&gt; root = session.getNode(<code>'/server/filters/i18n'</code>)</code></p>
</div>
<div class="paragraph">
<p><code>===&#8658; node /server/filters/i18n</code></p>
</div>
<div class="paragraph">
<p><code>mgnl&gt; root.getProperty(<code>'enabled'</code>).getString()</code></p>
</div>
<div class="paragraph">
<p><code>===&#8658; ``true</code></p>
</div>
<div class="paragraph">
<p><code>mgnl&gt; root.setProperty(<code>'enabled'</code>, <code>'false'</code>)</code></p>
</div>
<div class="paragraph">
<p><code>===&#8658; property /server/filters/i18n/enabled</code></p>
</div>
<div class="paragraph">
<p><code>mgnl&gt; root.getProperty(<code>'enabled'</code>).getString()</code></p>
</div>
<div class="paragraph">
<p><code>===&#8658; ``false</code></p>
</div>
<div class="paragraph">
<p><code>mgnl&gt; session.save()</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 3: Assign the content of the <code>/server/filters/i18n</code> node to
<code>root</code>.</p>
</li>
<li>
<p>Line 5: Check the current setting of the <code>enabled</code> property.</p>
</li>
<li>
<p>Line 7: Set the property to <code>false</code>.</p>
</li>
<li>
<p>Line 9: Verify that the configuration has been changed.</p>
</li>
<li>
<p>Line 11:
<span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
Save the session.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="src-196597001_Groovymodule-DeregisterGroovyRescueApp"><a class="anchor" href="#src-196597001_Groovymodule-DeregisterGroovyRescueApp"></a>Deregister Groovy Rescue App</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In web.xml, remove the servlet registration lines you added above.</p>
</li>
<li>
<p>Remove comments from the filter and filter-mapping sections.</p>
</li>
<li>
<p>Save web.xml.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Tomcat should notice that web.xml changed and read the changes
automatically. If this does not happen, stop Magnolia, edit <code>web.xml</code>,
and start Magnolia again. Then try to access Magnolia.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196597001_Groovymodule-Furtherresources"><a class="anchor" href="#src-196597001_Groovymodule-Furtherresources"></a>Further resources</h3>
<div class="ulist">
<ul>
<li>
<p>groovy Javadocs</p>
</li>
<li>
<p><a href="http://jira.magnolia-cms.com/browse/MGNLGROOVY">Issue tracker</a></p>
</li>
<li>
<p><a href="http://wiki.magnolia-cms.com/display/WIKI/Groovy+Shell+Scripts">More
scripts</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Google Analytics Visualization module</p>
</div>
<div class="paragraph">
<p>IBM WebSphere compatibility module</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
