<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Cache Policies module - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/6.2.1/core/modules/Advanced_Cache_Policies_module.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../../magnolia-general/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.1</button>
  <div class="version-menu">
    <a class="version is-current" href="Advanced_Cache_Policies_module.html">6.2.1</a>
    <a class="version is-missing" href="../../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="Advanced_Cache_Policies_module.html">Advanced Cache Policies module - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="6.2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../rn/release-notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/dump/Magnolia-Cloud.html">Dump Index</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Authoring.html">Authoring</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">Advanced Cache Policies module - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Modules.html" class="bare">Modules.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Modules.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="">&#8230;&#8203;</a></p>
</li>
<li>
<p><a href="List_of_modules.html">List of modules</a></p>
</li>
<li>
<p><a href="Advanced_cache_modules.html">Advanced cache modules</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596786"><a class="anchor" href="#src-196596786"></a>Advanced Cache Policies module</h2>
<div class="sectionbody">
<table id="main-content" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Edition</th>
<th class="tableblock halign-left valign-top">DX Core</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.magnolia-cms.com/mla">MLA</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://jira.magnolia-cms.com/browse/MGNLADVCACHE">MGNLADVCACHE</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maven site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://nexus.magnolia-cms.com/content/sites/magnolia.enterprise.sites/magnolia-module-advanced-cache/">Advanced
Cache</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Advanced Cache module is collection of advanced cache strategies to
help minimize load on the server while ensuring fresh content is served
to the users.</p>
</div>
<div class="sect2">
<h3 id="src-196596786_AdvancedCachePoliciesmodule-Installing"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Installing"></a>Installing</h3>
<div class="paragraph">
<p>Maven is the easiest way to install the module. Add the following to
your
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Bundles+and+webapps">bundle</a>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;info.magnolia.advancedcache&lt;/groupId&gt;
  &lt;artifactId&gt;magnolia-advanced-cache&lt;/artifactId&gt;
  &lt;version&gt;2.3.1&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596786_AdvancedCachePoliciesmodule-Uninstalling"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Uninstalling"></a>Uninstalling</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set cache policy in
<code>/modules/cache/config/contentCaching/defaultPageCache/cachePolicy@class</code>
back to default value <code>info.magnolia.module.cache.cachepolicy.Default</code>.</p>
</li>
<li>
<p>Remove the <code>/modules/advanced-cache</code> node and its subnodes.</p>
</li>
<li>
<p>Shut down Magnolia, remove the Advanced Cache module JAR
(<code>magnolia-advanced-cache.jar</code>) from <code>WEB-INF/lib</code> and start up Magnolia
again.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="src-196596786_AdvancedCachePoliciesmodule-Cachingstrategies"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Cachingstrategies"></a>Caching strategies</h3>
<div class="sect3">
<h4 id="src-196596786_AdvancedCachePoliciesmodule-Servingoldcontentwhilere-caching"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Servingoldcontentwhilere-caching"></a>Serving old content while re-caching</h4>
<div class="paragraph">
<p>Using this strategy, cache is not completely cleaned on content update
and entries are retained. After update, when the first request comes in,
fresh cache entry generation is triggered and all further requests for
the same entry are served from old cache content until the new entry is
ready.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set
<code>/modules/cache/config/contentCaching/defaultPageCache/cachePolicy@class</code>
to <code>info.magnolia.module.advancedcache.ServeUntilRecachedCachePolicy</code></p>
</li>
<li>
<p>Set
<code>/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/policies/flushAll@class</code>
to <code>info.magnolia.module.advancedcache.NotifyFlushListeningPolicy</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also:
<a href="#src-196596786_AdvancedCachePoliciesmodule-Timestampforlastflushing">Timestamp
for last flushing</a></p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596786_AdvancedCachePoliciesmodule-Eagerre-caching"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Eagerre-caching"></a>Eager re-caching</h4>
<div class="paragraph">
<p>Using this strategy, cache keeps a list of the most frequently served
entries. The system attempts to refresh these entries as soon as it
detects an update to content. All other entries are re-cached on
request. It is possible to configure the number of entries to re-cache
immediately and to set the lifetime of the most served content:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set
<code>/modules/cache/config/contentCaching/defaultPageCache/cachePolicy@class</code>
to <code>info.magnolia.module.advancedcache.EagerRecacheCachePolicy</code></p>
</li>
<li>
<p>Set
<code>/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/flushAll@class</code>
to <code>info.magnolia.module.advancedcache.EagerRecacheFlushPolicy</code> <br></p>
</li>
<li>
<p>Set
<code>/modules/cache/config/contentCaching/defaultPageCache/executors/store/cacheContent@class</code>
to <code>info.magnolia.module.cache.executor.Store</code><br>
<br></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, statistics about served pages are retained indefinitely.
However, you can force the system to flush the cache after each content
update. To do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>resetAfterUpdate</code> property node under <code>flushPolicy</code>.</p>
</li>
<li>
<p>Set the value to <code>true</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To change the number of pages to be eagerly re-cached:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an <code>eagerRecache</code> property node under <code>flushPolicy</code>.</p>
</li>
<li>
<p>Set the value to the number of top most entries in the list you wish
to have eagerly re-cached on every update. By default top 100 entries
are eagerly re-cached.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also:
<a href="#src-196596786_AdvancedCachePoliciesmodule-Timestampforlastflushing">Timestamp
for last flushing</a></p>
</div>
<div class="sect4">
<h5 id="src-196596786_AdvancedCachePoliciesmodule-Changingwaitingtime"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Changingwaitingtime"></a>Changing waiting time</h5>
<div class="paragraph">
<p>By default Magnolia waits for 10 seconds, while still serving an old
version of the content, before attempting to re-cache the given entry.
This timeout is controlled by the <code>blockingTimeout</code> property configured
in the <a href="Ehcache_3_module.html">Ehcache 3 back-end</a>. The
<code>blockingTimeout</code> applies to the whole cache factory. If you want to
change the waiting time for a particular cache policy, use the <code>timeout</code>
property.</p>
</div>
<div class="paragraph">
<p>Change the waiting time for the default server and flush
<a href="Cache_core.html#src-196596766_Cachecore-Policyconfiguration">policies</a>
by adding a <code>timeout</code> node data with value being the number of
milliseconds to wait (i.e. default value is equivalent of 10 000).</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Changes to cache policies and executors are applied immediately. Setting
incorrect values can render the Magnolia instance inaccessible. If this
happens, try the <a href="Groovy_module.html">Groovy Rescue app</a>.</p>
</div>
<div class="paragraph">
<p>See also <a href="Cache_core.html">Cache core module</a> .</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="src-196596786_AdvancedCachePoliciesmodule-Timestampforlastflushing"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Timestampforlastflushing"></a>Timestamp for last flushing</h4>
<div class="paragraph">
<p>The advanced flush policies update a <code>lastUpdateTimestamp</code> property to
record the last flushing event. The timestamp allows the corresponding
cache policy to identify which cache entries need to be regenerated.
When you delegate cache to an advanced cache policy, create a property
at a path that includes the name of your custom policy.</p>
</div>
<div class="paragraph">
<p><strong>Example 1</strong>: Serving old content while re-caching</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/modules/advanced-cache/config/notifyFlushListeningPolicy@lastUpdateTimeStamp</code>
(default)</p>
</li>
<li>
<p><code>/modules/advanced-cache/config/notifyFlushListeningPolicy/&lt;custom_cache_name&gt;@lastUpdateTimeStamp</code>
(custom)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example 2</strong>: Eager re-caching</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/modules/advanced-cache/config/eagerRecacheFlushPolicy@lastUpdateTimeStamp</code>
(default)</p>
</li>
<li>
<p><code>/modules/advanced-cache/config/eagerRecacheFlushPolicy/&lt;custom_cache_name&gt;@lastUpdateTimeStamp</code>
(custom)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>where <code>&lt;custom_cache_name&gt;</code> is the name of your custom policy.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596786_AdvancedCachePoliciesmodule-Multisitecacheconfiguration"><a class="anchor" href="#src-196596786_AdvancedCachePoliciesmodule-Multisitecacheconfiguration"></a>Multisite cache configuration</h3>
<div class="paragraph">
<p>When content is published, the cache on the public instance is flushed
to show the new content. This increases the load on the server and
affects all sites in a
<a href="https://wiki.magnolia-cms.com/display/DOCS62/How+to+use+Multisite">multisite</a>
environment. You can configure multiple cache configurations to ensure
that only cache entries that belong to the same subree (site) as the
published content are flushed. Use
<a href="Advanced_Cache_app_module.html">Advanced Cache app module</a> for easy
configuration or just do it manually:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set
<code>/modules/advanced-cache/config@createSeparateCachesForEachSite=true.</code>
This creates caches for each site defined. It uses the
<code>defaultPageCache</code> configuration for each site if
<code>/modules/cache/config/contentCaching/SITE-NAME</code> doesn&#8217;t exist.</p>
</li>
<li>
<p>Set
`/server/filters/cache@class=info.magnolia.module.advancedcache.filter.SiteAwareCacheFilter.`This
filter chooses the right site-specific cache to use so you don&#8217;t need to
have separate cache filters per cache.</p>
</li>
<li>
<p>Create
<code>/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/policies/flushSiteAware@class=info.magnolia.module.advancedcache.SiteAwareFlushAllListeningPolicy</code>.</p>
</li>
<li>
<p>For all site-aware workspaces (those which have separate subtrees for
each site):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Exclude the workspace from the default flush policy:
<code>/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/policies/flushAll/excludedWorkspaces@WORKSPACE_NAME=WORKSPACE_NAME</code>.</p>
</li>
<li>
<p>Register this workspace to site aware flush policy:
<code>/modules/cache/config/contentCaching/defaultPageCache/flushPolicy/policies/flushSiteAware/workspaces@WORKSPACE_NAME=WORKSPACE_NAME</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Restart your instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Advanced Cache app module</p>
</div>
<div class="paragraph">
<p>High performance caching modules</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
