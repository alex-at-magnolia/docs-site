<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Custom tasks - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/6.2.1/core/modules/Custom_tasks.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../../magnolia-docs/6.2/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../../magnolia-general/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.1</button>
  <div class="version-menu">
    <a class="version is-current" href="Custom_tasks.html">6.2.1</a>
    <a class="version is-missing" href="../../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="Custom_tasks.html">Custom tasks - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="6.2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../rn/release-notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/Magnolia-Cloud.html">Cloud</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Authoring.html">Authoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connector-packs/Connector_Packs.html">Connector Packs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#core/apps/apps.adoc">Apps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">Custom tasks - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Modules.html" class="bare">Modules.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Modules.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="">&#8230;&#8203;</a></p>
</li>
<li>
<p><a href="List_of_modules.html">List of modules</a></p>
</li>
<li>
<p><a href="Workflow_module.html">Workflow module</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196597482"><a class="anchor" href="#src-196597482"></a>Custom tasks</h2>
<div class="sectionbody">
<div id="main-content" class="paragraph">
<p>From jBPM
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMDomainSpecificProcesses.html">documentation</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>jBPM provides the ability to create and use domain-specific task nodes
in your business processes. This simplifies development when you&#8217;re
creating business processes that contain tasks dealing with other
technical systems.</p>
</div>
<div class="paragraph">
<p>When using jBPM, we call these domain-specific task nodes "custom work
items" or (custom) "service nodes". There are two separate aspects to
creating and using custom work items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding a node with a custom work item to a process definition using
the Eclipse editor or jBPM designer.</p>
</li>
<li>
<p>Creating a custom work item handler that the jBPM engine will use when
executing the custom work item in a running process.</p>
</li>
</ul>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Custom tasks are also called as <em>domain specific tasks</em>. The technical
term is <em>work item</em> and its <em>work item handler</em>.</p>
</div>
<div class="paragraph">
<p>A work item is an XML node inside your process definition. The
respective work item handler is a Java class that implements the
<code>org.kie.api.runtime.process.WorkItemHandler</code> interface. This document
explains how to integrate and configure a work item handler and how to
use the handler to execute a work item.</p>
</div>
<div class="sect2">
<h3 id="src-196597482_Customtasks-Workitemhandlerregistry"><a class="anchor" href="#src-196597482_Customtasks-Workitemhandlerregistry"></a>Work item handler registry</h3>
<div class="paragraph">
<p>The mapping between a work item and its handler is based on the work
item name. The name has to be added to the jBPM Environment when
starting the engine. In Magnolia we use an observed registry for work
item handlers. The registry is under the <code>workItemHandlers</code> node in
module configuration. Custom handlers can be configured in any module
using YAML or JCR.</p>
</div>
<div class="paragraph">
<p>Here are the default work item handlers registered in Magnolia:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597482/default-work-item-handlers.png" alt="images/download/attachments/196597482/default-work-item-handlers.png"></span></p>
</div>
<div class="paragraph">
<p>The expanded <code>rejectNotification</code> handler shows the properties needed to
register a handler:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>class</code>: The definition class of a work item is similar to any other
definition class in Magnolia. The fields you make accessible using
getters and setters on the definition are accessible to the
implementation by injecting the definition into it. This is one
possibility to access data from within your handler in the process.
Another option is passing a parameter map when launching the process.</p>
</li>
<li>
<p><code>implementationClass</code>: An implementation class executes the work item.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="src-196597482_Customtasks-Decorators"><a class="anchor" href="#src-196597482_Customtasks-Decorators"></a>Decorators</h3>
<div class="paragraph">
<p>Do not re-implement similar mechanisms over and over again. Introduce
decorators for your handlers when you need some common functionality in
handlers. A decorator allows you to wrap an existing work item handler
implementation into another handler. Both handlers must implement the
same <code>WorkItemHandler</code> interface.</p>
</div>
<div class="paragraph">
<p>Decorator configuration is similar to handler configuration. A decorator
needs a definition and an implementation configured. When the handler is
loaded into Magnolia during system startup, it looks for a <code>decorator</code>
node in the configuration. If the node is found the original handler is
wrapped into the decorator by passing the original handler as parameter.
Also passed are the decorator definition and any other objects
accessible through injection.</p>
</div>
<div class="paragraph">
<p>Error handling is an example of decoration. A technical error during
execution throws an exception:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597482/work-item-handler-decorator-configuration.png" alt="images/download/attachments/196597482/work-item-handler-decorator-configuration.png"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="src-196597482_Customtasks-Errorhandling"><a class="anchor" href="#src-196597482_Customtasks-Errorhandling"></a>Error handling</h3>
<div class="paragraph">
<p>Error handling in process execution is not a trivial topic. Start
implementing error handling the moment you start modeling your process.
You have to know what can go wrong and you need to decide what to do in
case of errors. As a rule of thumb, exception and error handling should
be handled inside your process and be isolated from the rest of the
system.</p>
</div>
<div class="paragraph">
<p>See
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMExceptionManagement.html">jBPM
Exception Management</a>.</p>
</div>
<div class="sect3">
<h4 id="src-196597482_Customtasks-Errorhandlingusingadecorator"><a class="anchor" href="#src-196597482_Customtasks-Errorhandlingusingadecorator"></a>Error handling using a decorator</h4>
<div class="paragraph">
<p>As described in
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMExceptionManagement.html#d0e15421">jBPM
Technical Exceptions</a>, you can use decorators for handling errors in
custom tasks where an error is an exception thrown during the execution
of a task. <code>ThrowExceptionHandlerDecorator</code> is a sample implementation
of a decorator for wrapping any kind of task. The decorator catches any
kind of exception thrown during <code>execute</code> and <code>abort</code> phase of the
handler and wraps the exception into a
<code>WorkItemHandlerRuntimeException</code>.</p>
</div>
<div class="paragraph">
<p>The exception can then be caught as part of the process using an <em>Error
Boundary Event</em>, letting the process take care of error handling. The
advantage of this approach is that you clearly see where errors can
happen and the associated handling is evident at process level. You can
re-use the pattern for other custom tasks that may fail.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597482/Screen_Shot_2014-06-19_at_17.00.35.png" alt="images/download/attachments/196597482/Screen_Shot_2014-06-19_at_17.00.35.png"></span></p>
</div>
<div class="paragraph">
<p>Apart from using Magnolia&#8217;s own exception decorator you can also use the
decorators provided by jBPM such as <code>SignallingTaskHandlerDecorator</code> or
<code>LoggingTaskHandlerDecorator</code>. Set the <code>HandlerDecoratorDefinition</code> in
the <code>class</code> property and the decorator implementation in the
<code>implementationClass</code> property in your configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597482_Customtasks-Errorhandlerdecoratorconfiguration"><a class="anchor" href="#src-196597482_Customtasks-Errorhandlerdecoratorconfiguration"></a>Error handler decorator configuration</h4>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597482/error-handler-decorator-configuration.png" alt="images/download/attachments/196597482/error-handler-decorator-configuration.png"></span></p>
</div>
<div class="paragraph">
<p><code>ThrowExceptionHandlerDecorator</code> properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>class</code></p>
</li>
<li>
<p><code>implementationClass</code>: The actual implementation of the decorator</p>
</li>
<li>
<p><code>log</code>: Whether the caught exception should be logged. Default is
<code>false</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="src-196597482_Customtasks-Modelinganerror"><a class="anchor" href="#src-196597482_Customtasks-Modelinganerror"></a>Modeling an error</h4>
<div class="paragraph">
<p>Define the error at the process level in the BPMN2 editor:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597482/Screen_Shot_2014-06-19_at_17.07.13.png" alt="images/download/attachments/196597482/Screen_Shot_2014-06-19_at_17.07.13.png"></span></p>
</div>
<div class="paragraph">
<p>Reference the error from the Error Boundary Event:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/download/attachments/196597482/Screen_Shot_2014-07-08_at_13.48.35.png" alt="images/download/attachments/196597482/Screen_Shot_2014-07-08_at_13.48.35.png"></span></p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>In jBPM 6 there are some technical restrictions in using Error Boundary
Events which should be solved in upcoming releases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The exception is not mapped to the <em>Target</em>. You cannot retrieve the
exception later on in the process.</p>
</li>
<li>
<p>In theory you should not have to use the <em>FQN</em> of the exception, but
rather define a human readable name of the error.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196597482_Customtasks-Asynchronousexecution"><a class="anchor" href="#src-196597482_Customtasks-Asynchronousexecution"></a>Asynchronous execution</h3>
<div class="paragraph">
<p>As process execution runs synchronously you will run into problems
executing long-running tasks as part of the process. There are different
solutions to approach this problem. See
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMAsyncExecution.html">jBPM:
Concurrency and asynchronous execution</a> before proceeding.</p>
</div>
<div class="sect3">
<h4 id="src-196597482_Customtasks-Executingyourworkitemhandlerasynchronously"><a class="anchor" href="#src-196597482_Customtasks-Executingyourworkitemhandlerasynchronously"></a>Executing your work item handler asynchronously</h4>
<div class="paragraph">
<p>Instead of spawning a thread manually inside your work item handler as
outlined in
<a href="http://docs.jboss.org/jbpm/v6.0.1/userguide/jBPMAsyncExecution.html#d0e16493">jBPM:
Asynchronous execution</a>, you can extend Magnolia&#8217;s
<code>AsyncWorkItemHandler</code> which takes advantage of the asynchronous Quartz
scheduler for launching long running tasks. The benefit of extending
this abstract handler is that you can model the error handling the same
way as in <a href="#src-196597482_Customtasks-Modelinganerror">Modeling an
error</a> using an <em>Error Boundary Event</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597482_Customtasks-Implementation"><a class="anchor" href="#src-196597482_Customtasks-Implementation"></a>Implementation</h4>
<div class="paragraph">
<p>In your implementer class, extend <code>AsyncWorkItemHandler</code> and implement
the abstract methods that take care of creating Quartz related objects
such as <code>Trigger</code> and <code>JobDetail</code>. See
<a href="http://quartz-scheduler.org/documentation">Quartz documentation</a> for
details. (Magnolia currently bundles Quartz 1.8)</p>
</div>
<div class="paragraph">
<p>info.magnolia.module.workflow.jbpm.workitem.handler.AsyncWorkItemHandler</p>
</div>
<div class="paragraph">
<p><code>public<code> </code>abstract<code> </code>class<code> AsyncWorkItemHandler </code>implements`</code> WorkItemHandler {`</p>
</div>
<div class="paragraph">
<p>`    <code>`@Inject</code></p>
</div>
<div class="paragraph">
<p>`    <code>public</code> AsyncWorkItemHandler(&#8230;&#8203;) {`</p>
</div>
<div class="paragraph">
<p>`      &#8230;&#8203;`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p>`    <code>protected</code> <code>abstract</code> String getJobName(WorkItem workItem);`</p>
</div>
<div class="paragraph">
<p>`    <code>protected</code> <code>abstract</code> String getHandlerName();`</p>
</div>
<div class="paragraph">
<p>`    <code>protected</code> <code>abstract</code> JobDetail createJobDetail(String jobName, WorkItem workItem);`</p>
</div>
<div class="paragraph">
<p>`    <code>protected</code> <code>abstract</code> Trigger createTrigger(String jobName, WorkItem workItem);`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
</div>
<div class="sect3">
<h4 id="src-196597482_Customtasks-Errorhandlinginasynchronousexecution"><a class="anchor" href="#src-196597482_Customtasks-Errorhandlinginasynchronousexecution"></a>Error handling in asynchronous execution</h4>
<div class="paragraph">
<p>Error handling during asynchronous execution is done by registering a
Quartz <code>JobListener</code> to the scheduler. The listener handles a failed job
in the same way an error decorator handles errors. In case you need to
change the default behavior, override the
<code>AsyncWorkItemHandler#getListener(String jobName)</code> method in your
implementation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196597482_Customtasks-Tutorial"><a class="anchor" href="#src-196597482_Customtasks-Tutorial"></a>Tutorial</h3>
<div class="paragraph">
<p>We have put together a
<a href="Creating_a_custom_workflow_process.html">step-by-step tutorial</a> on
how to model, implement and load custom work item handlers.</p>
</div>
<div class="paragraph">
<p>Creating a custom workflow process</p>
</div>
<div class="paragraph">
<p>User tasks</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
