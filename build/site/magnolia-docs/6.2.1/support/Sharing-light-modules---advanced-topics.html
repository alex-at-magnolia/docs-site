<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sharing light modules - advanced topics - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/6.2.1/support/Sharing-light-modules---advanced-topics.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../magnolia-docs/6.2/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../magnolia-docs/6.2/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../magnolia-general/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">6.2.1</button>
  <div class="version-menu">
    <a class="version is-current" href="Sharing-light-modules---advanced-topics.html">6.2.1</a>
    <a class="version is-missing" href="../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Magnolia Documentation</a></li>
    <li><a href="Sharing-light-modules---advanced-topics.html">Sharing light modules - advanced topics - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="6.2.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rn/release-notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cloud/Magnolia-Cloud.html">Cloud</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/modules/Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/authoring/Authoring.html">Authoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/connector-packs/Connector_Packs.html">Connector Packs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/apps/Apps.html">Apps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/cli/Magnolia-CLI.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../special-features/Special-Features.html">Special Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Support.html">Need Support?</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">Sharing light modules - advanced topics - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Support.html" class="bare">Support.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Support.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="">&#8230;&#8203;</a></p>
</li>
<li>
<p><a href="Contribute.html">Contribute</a></p>
</li>
<li>
<p><a href="Finding-and-sharing-light-modules.html">Finding and sharing light
modules</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196598639"><a class="anchor" href="#src-196598639"></a>Sharing light modules - advanced topics</h2>
<div class="sectionbody">
<div id="main-content" class="paragraph">
<p>This page provides some guidelines on how to handle <em>advanced</em> front-end
topics when sharing a light module.</p>
</div>
<div class="paragraph">
<p>Using npm to share Magnolia light modules provides great opportunities
to take advantage of the npm dependency resolution, and to incorporate
front-end build processes.</p>
</div>
<div class="paragraph">
<p>With light development and sharing on npm, Magnolia in no way seeks to
create another front-end framework. The initiative is about making it
easy for authors to include the benefits and innovations in the
front-end frameworks, javascript libraries and web-based services in
their web projects. Our goal is to provide guidelines to the Magnolia
community to ensure that packages are easy-to-understand and use, and
that the developers of packages have complete flexibility in how their
package is built and interacts with the rest of the npm and the
front-end ecosystem.</p>
</div>
<div class="paragraph">
<p>In this page, we assume:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your npm package is a ready-to-use light module.</p>
</li>
<li>
<p>The source control project contains all the information about the
project, but is not necessarily a functional light module.</p>
</li>
<li>
<p>Running <code>npm run build</code> creates a functional light module.</p>
</li>
<li>
<p>Each module is responsible for its own build.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="src-196598639_safe-id-U2hhcmluZ2xpZ2h0bW9kdWxlcy1hZHZhbmNlZHRvcGljcy1Gcm9udGVuZGJ1aWxkcHJvY2Vzc2VzKExFU1MsU0FTUyxFUzZhbmRzb29uKQ"><a class="anchor" href="#src-196598639_safe-id-U2hhcmluZ2xpZ2h0bW9kdWxlcy1hZHZhbmNlZHRvcGljcy1Gcm9udGVuZGJ1aWxkcHJvY2Vzc2VzKExFU1MsU0FTUyxFUzZhbmRzb29uKQ"></a>Frontend build processes (LESS, SASS, ES6 and so on)</h3>
<div class="paragraph">
<p>Each module contains <em>its own build pipeline</em> which is run when the
<code>npm run build</code> command is executed. This build pipeline processes the
source files provided in the <code>_dev</code> directory and typically generates
files in the <code>webresources</code> directory.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Magnolia does not recommend any specific build for a module.</p>
</div>
<div class="paragraph">
<p>This is because there exist many rapidly changing front-end tools. We do
not want to limit users to a single build pipeline at the project level
that all modules would have to adhere to. With a module-level build,
each module has the freedom to select its own build pipeline and is sure
that it will build properly, no matter the project "environment".</p>
</div>
<div class="paragraph">
<p>The npm <code>package.json</code> <code>prepublish</code> script should run <code>npm run build</code> so
that the build pipeline will be run whenever the package is published.
This ensures that all packages on npm are always 'built' and ready to
use as light modules.</p>
</div>
<div class="paragraph">
<p>The <code>_dev</code> directory with all its source files, and the build config
files like <code>.babelrc</code> should be excluded from the built npm package.
This is accomplished by listing them in the standard <code>.npmignore</code> file.</p>
</div>
<div class="paragraph">
<p>As a best practice, consider including any built files in a <code>.gitignore</code>
file. This ensures that devs using the project will get a build based on
the latest versions, eliminates redundancy, and serves to document what
is being generated.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/magnolia-cms/calculator-magnolia" class="bare">https://github.com/magnolia-cms/calculator-magnolia</a> Illustrates
building an ES5 JS file from several ES6 files. It also demonstrates
building css from Less files. It includes the prepublish hook and the
.npmignore file.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="src-196598639_Sharinglightmodules-advancedtopics-npmlibrarydependencies"><a class="anchor" href="#src-196598639_Sharinglightmodules-advancedtopics-npmlibrarydependencies"></a>npm library dependencies</h3>
<div class="paragraph">
<p>A light module will often rely on functionality provided by other npm
packages, typically javascript or css. For example, a component that
exposes the features of a js library like chart.js to content authors.
To be DRY, the light module source control project (ie github) should
not include those libraries.</p>
</div>
<div class="paragraph">
<p>Based on the same "module-level build" introduced above, a module should
declare those projects as npm <code>dependencies</code> in its <code>package.json</code>. The
build pipeline must include a step to either generate new resources (js,
css, etc) based on those dependencies, or simply copy resources from
those dependencies - and place them in the <code>webresources</code> directory.</p>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/magnolia-cms/chartjs-magnolia" class="bare">https://github.com/magnolia-cms/chartjs-magnolia</a> Illustrates a very
simple build pipeline, it just copies the js file that it depends on
from the chartjs package.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Big popular libraries like jquery and angular should usually not be
brought in via npm dependencies. Since many components are likely to
depend on them, and they are available via CDN, a project developer will
usually prefer to manage those libraries "by hand".</p>
</div>
<div class="paragraph">
<p>Note that it is the modules job to generate/copy the proper resources in
the webresources directory, but not to handle how they get into the web
page. This is left to the project developer so that they can use the web
resources strategy that makes the most sense for their project (resfn,
theme, include, etc).</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196598639_Sharinglightmodules-advancedtopics-Testing"><a class="anchor" href="#src-196598639_Sharinglightmodules-advancedtopics-Testing"></a>Testing</h3>
<div class="paragraph">
<p>A light module can contain unit tests for any custom javascript
functionality using standard js testing frameworks.</p>
</div>
<div class="paragraph">
<p>To test magnolia rendering, integration tests can easily be provided to
test a demo page for the presence of expected DOM. These tests can be
written with the <a href="https://github.com/cheeriojs/cheerio">cheerio library</a>
which leverages jQuery for easily selecting the contents of the html
DOM. For example, a demo page could contain the same component, but
configured via the dialog in 4 different ways. A test could check each
rendered version for expected HTML elements. You could use more
sophisticated approaches than simple DOM tests, such as selenium to test
user interactions with your components.</p>
</div>
<div class="paragraph">
<p>Tests are especially valuable for open source projects. They make it
easier for people to contribute to your project, because they (and you)
will see if they have broken anything.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/magnolia-cms/calculator-magnolia" class="bare">https://github.com/magnolia-cms/calculator-magnolia</a> Illustrates unit
and integration tests which are automatically run on the
<a href="https://travis-ci.org/" class="bare">https://travis-ci.org/</a> service whenever a <code>git push</code> is made on the
repository. Travis build status for this project:
<a href="https://travis-ci.org/magnolia-cms/calculator-magnolia" class="bare">https://travis-ci.org/magnolia-cms/calculator-magnolia</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Steps to create a test of magnolia rendering (illustrated in the above
project):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a demo page with one or more instances of your component
configured in various ways via the dialog.</p>
</li>
<li>
<p>Export the page as an xml bootstrap file to the <code>_dev/demos</code>
directory.</p>
</li>
<li>
<p>Supply a test script in <code>_dev/test/integration</code> which loads the demo
webpage and checks the rendered DOM for expected contents. (For example
with the <code>cheerio</code> library.)</p>
</li>
<li>
<p>Add an integration and test script to the <code>package.json</code>.</p>
</li>
<li>
<p>Supply a <code>.travis.yml</code> configuration, and connect your git repo to the
free travis-ci continuous integration service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional details:
<a href="https://wiki.magnolia-cms.com/display/DEVINT/Testing+Light+Modules+for+Frontend+Developers">Testing
Light Modules for Frontend Developers</a></p>
</div>
</div>
<div class="sect2">
<h3 id="src-196598639_safe-id-U2hhcmluZ2xpZ2h0bW9kdWxlcy1hZHZhbmNlZHRvcGljcy1MaWdodHByb2plY3Q6RnJvbnQtZW5kYnVpbGRvbnRoZWVudGlyZXByb2plY3Q"><a class="anchor" href="#src-196598639_safe-id-U2hhcmluZ2xpZ2h0bW9kdWxlcy1hZHZhbmNlZHRvcGljcy1MaWdodHByb2plY3Q6RnJvbnQtZW5kYnVpbGRvbnRoZWVudGlyZXByb2plY3Q"></a>Light project: Front-end build on the entire project</h3>
<div class="paragraph">
<p>A light project consists of a package.json file which declares all of
the light modules in the project as npm dependencies, and any required
build pipeline. A light project is an optional concept.</p>
</div>
<div class="paragraph">
<p>For each shared light module, we recommend a module-level build.
However, on a project level, you may want to further process the
contents of all modules in your project. The most common use case is
that you want to concatenate or minify the web resources from all the
modules into a fewer number of resources. Projects often have only
app.js and styles.css files.</p>
</div>
<div class="paragraph">
<p>For a light project setup we suggest the following directory structure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The light-project files at the root of the directory.</p>
</li>
<li>
<p>A <code>src</code> directory where the project can put the dependencies.</p>
</li>
<li>
<p>A <code>dist</code> directory where the project will place the processed light
modules. The <code>dist</code> directory functions as your
`magnoila.resources.dir `directory.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Clean</th>
<th class="tableblock halign-left valign-top">Built</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../_images/images/download/attachments/196598639/light-project-fresh.png" alt="images/download/attachments/196598639/light-project-fresh.png"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="../_images/images/download/attachments/196598639/light-project-built.png" alt="images/download/attachments/196598639/light-project-built.png" height="250"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/magnolia-cms/light-project-example-gulp" class="bare">https://github.com/magnolia-cms/light-project-example-gulp</a> A light
project builder based on Gulp</p>
</li>
<li>
<p><a href="https://github.com/magnolia-cms/light-project-example-webpack" class="bare">https://github.com/magnolia-cms/light-project-example-webpack</a> A light
project builder based on Webpack</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="src-196598639_Sharinglightmodules-advancedtopics-Localmodules"><a class="anchor" href="#src-196598639_Sharinglightmodules-advancedtopics-Localmodules"></a>Local modules</h4>
<div class="paragraph">
<p>If some of the modules that your project depends on are on your hard
drive instead of npm, you can reference the files directly. Npm then
builds the project (if a prepublish hook is defined) and takes the
<code>.npmignore</code> of the module into account.</p>
</div>
<div class="paragraph">
<p><code>"dependencies"`</code>: {`</p>
</div>
<div class="paragraph">
<p>`    <code>"calculator-magnolia"</code>: <code>`"../[whatever-path-on-filesystem/]calculator-magnolia"</code></p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p>Retrieving light modules</p>
</div>
<div class="paragraph">
<p>Deprecation policy</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
