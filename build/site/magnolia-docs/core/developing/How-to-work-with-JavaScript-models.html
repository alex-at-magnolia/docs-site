<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to work with JavaScript models - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/core/developing/How-to-work-with-JavaScript-models.html">
    <meta name="generator" content="Antora 2.3.3">
<link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
        <script src="https://use.fontawesome.com/ecc89e1666.js"></script>
    <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item magnolia-logo" href="../../../index.html">
      </a>
      <input type="search" placeholder="Search the docs" name="search" id="searchBar">


      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item disabled" href="../../../magnolia-docs/6.2.1/core/index.html">Core</a>
        <a class="navbar-item disabled" href="../../../magnolia-docs/6.2.1/cloud/index.html">Cloud</a>
        <a class="navbar-item disabled" href="../../../magnolia-docs/6.2.1/faqs.html">FAQs</a>
        <a href="https://www.magnolia-cms.com/get-started.html" class="navbar-item" target="_blank"><button class="magnolia-btn">Try Magnolia</button></a>
      </div>
    </div>
  </nav>
</header>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">master</button>
  <div class="version-menu">
    <a class="version is-current" href="How-to-work-with-JavaScript-models.html">master</a>
    <a class="version" href="../../6.2.1/core/developing/How-to-work-with-JavaScript-models.html">6.2.1</a>
    <a class="version is-missing" href="../../6.2/index.html">6.2</a>
  </div>
</div>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="How-to-work-with-JavaScript-models.html">How to work with JavaScript models - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>
</div>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../releases/Releases.html">Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../upgrade/Upgrading-to-Magnolia-6.2.x.html">Upgrading-to-Magnolia-6.2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../features/Features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../cloud/Magnolia-Cloud.html">Cloud</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templating/Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../modules/Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../authoring/Authoring.html">Authoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Logging_in.html">Logging in</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Editing_pages.html">Editing pages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Managing_pages.html">Managing pages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Editing_images.html">Editing images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Managing_assets.html">Managing assets</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Publishing.html">Publishing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Deleting_and_restoring.html">Deleting and restoring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Keyboard_shortcuts.html">Keyboard shortcuts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../authoring/Feeds.html">Feeds</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../connector-packs/Connector_Packs.html">Connector Packs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../apps/Apps.html">Apps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/Magnolia-CLI.html">Command Line Interface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../special-features/Special-Features.html">Special Features</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../support/Support.html">Need Support?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#FAQS.adoc">FAQs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
</div>
    </div>
  </aside>
</div>
<main>
<article class="doc">
    <h1 class="page">How to work with JavaScript models - Magnolia 6.2 documentation</h1>
    <div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Developing.html" class="bare">Developing.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Developing.html">Magnolia 6.2 documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596448"><a class="anchor" href="#src-196596448"></a>How to work with JavaScript models</h2>
<div class="sectionbody">
<div id="main-content" class="paragraph">
<p>Related topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.magnolia-cms.com/display/DOCS62/JavaScript+Models+module">JavaScript
Models module</a></p>
</li>
<li>
<p><a href="https://git.magnolia-cms.com/projects/LIGHT-MODULES/repos/javascript-model-samples">javascript-model-samples</a>
on Bitbucket</p>
</li>
<li>
<p><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/scripting/nashorn/api.html">Nashorn
Java API</a></p>
</li>
<li>
<p><a href="https://wiki.openjdk.java.net/display/Nashorn/Nashorn+extensions">Nashorn
extensions</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This page explains in detail how to use JavaScript models for templates.
JavaScript models can be done via
<a href="Light-development-in-Magnolia.html">Light development</a>, thus
enabling fast development and deployment without the need for Java,
Maven or WAR deployment. JavaScript models represent a type of Magnolia
<a href="Resources.html">Resources</a>.</p>
</div>
<div class="paragraph">
<p>If you want to use JavaScript models, make sure that your bundle
contains the <code>magnolia-module-javascript-models</code> module. For further
information see
<a href="https://wiki.magnolia-cms.com/display/DOCS62/JavaScript+Models+module">JavaScript
Models module - Installing</a>.</p>
</div>
<div class="sect2">
<h3 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtYW5jLWRlZmluaW5nLWFuZC1yZWZlcmVuY2luZ0RlZmluaW5nLHJlZmVyZW5jaW5nYW5kdXNpbmdhSmF2YVNjcmlwdG1vZGVs"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtYW5jLWRlZmluaW5nLWFuZC1yZWZlcmVuY2luZ0RlZmluaW5nLHJlZmVyZW5jaW5nYW5kdXNpbmdhSmF2YVNjcmlwdG1vZGVs"></a><span id="src-196596448_HowtoworkwithJavaScriptmodels-anc-defining-and-referencing " class="confluence-anchor-link">#</span>#Defining, referencing and using a JavaScript model</h3>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-base-recipe"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-base-recipe"></a><span id="src-196596448_HowtoworkwithJavaScriptmodels-base-recipe2 " class="confluence-anchor-link">#</span>#</h4>

</div>
<div class="sect3">
<h4 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtQmFzZXJlY2lwZTpVc2luZ2Fjb252ZW50aW9uZm9ybmFtaW5nYW5kbG9jYXRpb25vZnRoZW1vZGVs"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtQmFzZXJlY2lwZTpVc2luZ2Fjb252ZW50aW9uZm9ybmFtaW5nYW5kbG9jYXRpb25vZnRoZW1vZGVs"></a>Base recipe: Using a convention for naming and location of the model</h4>
<div class="paragraph">
<p>1. Set the model class property in the template definition.</p>
</div>
<div class="paragraph">
<p>rhino.yaml</p>
</div>
<div class="paragraph">
<p><code>templateScript: /your-light-module/templates/pages/rhino.ftl</code></p>
</div>
<div class="paragraph">
<p><code>renderType: freemarker</code></p>
</div>
<div class="paragraph">
<p><code>modelClass: info.magnolia.module.jsmodels.rendering.JavascriptRenderingModel</code></p>
</div>
<div class="paragraph">
<p>2. Create the model file in the same location as the template
definition and give it the name <code>&lt;template-name&gt;.js</code> . Create a
JavaScript "class" with properties and methods in the file and create an
instance at the end of the file.</p>
</div>
<div class="paragraph">
<p>rhino.js</p>
</div>
<div class="paragraph">
<p><code>var<code> Dumbo = </code>function`</code> () {`</p>
</div>
<div class="paragraph">
<p>`  <code>this</code>.name = <code>"John"</code>;`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>.getRandomNumber = <code>function</code> () {`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> Math.ceil(100 * Math.random());`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>};</code></p>
</div>
<div class="paragraph">
<p><code>new`</code> Dumbo();`</p>
</div>
<div class="paragraph">
<p>3. Use the model in the template script.</p>
</div>
<div class="paragraph">
<p>rhino.ftl</p>
</div>
<div class="paragraph">
<p><code>&lt;div&gt;Hey ${model.name}, your happiness level is at ${model.getRandomNumber()}%.&lt;/div&gt;</code></p>
</div>
<div class="paragraph">
<p>Reference the <code>model</code> in the script and use the properties or methods
defined within the model.</p>
</div>
<div class="paragraph">
<p>Files involved:</p>
</div>
<div class="paragraph">
<p><code>your-light-module/</code></p>
</div>
<div class="paragraph">
<p><code>└── templates</code></p>
</div>
<div class="paragraph">
<p>`    └── pages`</p>
</div>
<div class="paragraph">
<p>`        ├── rhino.ftl`</p>
</div>
<div class="paragraph">
<p>`        ├── rhino.js`</p>
</div>
<div class="paragraph">
<p>`        └── rhino.yaml`</p>
</div>
<div class="paragraph">
<p>This recipe works for both page and component templates.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-anc-using-class-and-modelPathUsingthemodelPathandclassproperty"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-anc-using-class-and-modelPathUsingthemodelPathandclassproperty"></a><span id="src-196596448_HowtoworkwithJavaScriptmodels-anc-using-class-and-modelPath " class="confluence-anchor-link">#</span>#Using the modelPath and class property</h4>
<div class="paragraph">
<p>With this approach you do not have to follow the naming convention. This
can be handy to use the same model among multiple templates.</p>
</div>
<div class="paragraph">
<p>Instead of the property <code>modelClass</code>, you must set the properties
<code>class</code> and <code>modelPath</code>. The value for the former must be
<code>info.magnolia.module.jsmodels.rendering.JavascriptTemplateDefinition</code>
and for the latter the path to the JavaScript model.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>rhino.yaml</p>
</div>
<div class="paragraph">
<p><code>templateScript: /your-light-module/templates/pages/rhino.ftl</code></p>
</div>
<div class="paragraph">
<p><code>renderType: freemarker</code></p>
</div>
<div class="paragraph">
<p><code>class`</code>: info.magnolia.module.jsmodels.rendering.JavascriptTemplateDefinition`</p>
</div>
<div class="paragraph">
<p><code>modelPath: /your-light-module/templates/common/baseModel.js</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtTmFzaG9ybixKYXZhU2NyaXB0YW5kdGhlSmF2YUFQSQ"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtTmFzaG9ybixKYXZhU2NyaXB0YW5kdGhlSmF2YUFQSQ"></a>Nashorn, JavaScript and the Java API</h3>
<div class="paragraph">
<p>When you write a JavaScript model, you obviously write a JavaScript
code. However, you will encounter objects which come from the Java
world. For instance this is true when you work with Magnolia&#8217;s built-in
<a href="#src-196596448_HowtoworkwithJavaScriptmodels-rendering-context-objects">rendering
context objects</a> or when using
<a href="#src-196596448_HowtoworkwithJavaScriptmodels-templating-functions">templating
functions</a>.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>When using objects originating in Java within a JavaScript model, it is
helpful to know their public methods, which you can also use within the
JavaScript code. To get familiar with these objects, it helps to have a
look at the Java API pages which list the public methods and the
corresponding return types. On this page you will find many links to
Java docs. Follow the links to get an understanding of these Java-origin
objects.</p>
</div>
<div class="paragraph">
<p>Examples: AggregationState (for the <code>state</code> object), ContentMap (for the
<code>content</code> object), SimpleTranslator (for the <code>i18n</code> object) etc.</p>
</div>
<div class="paragraph">
<p>Most context objects are
<a href="http://en.wikipedia.org/wiki/JavaBeans">JavaBeans</a>, which means you can
access their properties with the "dot" operator or a getter method in a
template script or in a JavaScript model. Both expressions are valid and
return the same value.</p>
</div>
<div class="paragraph">
<p><code>state.channel.name;</code></p>
</div>
<div class="paragraph">
<p><code>state.getChannel().getName();</code></p>
</div>
<div class="paragraph">
<p>Both the lines above have the same meaning.</p>
</div>
<div class="paragraph">
<p>[<mark>src-196596448_HowtoworkwithJavaScriptmodels-rendering-context-objects]</mark>#</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_HowtoworkwithJavaScriptmodels-Usingbuilt-inrenderingcontextobjects"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-Usingbuilt-inrenderingcontextobjects"></a>Using built-in rendering context objects</h3>
<div class="paragraph">
<p>In this section we take a look at the Magnolia built-in objects <code>model</code>
, <code>content</code>, <code>def</code>, <code>ctx</code>, <code>state</code> and <code>i18n</code> . These objects can be
used directly within a template script. Below you will see how to access
their properties within a JavaScript model.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/information.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/information.svg"></span>
The code snippets starting with <code>var</code> are in JavaScript and are intended
to be used within JavaScript models.</p>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-model"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-model"></a>model</h4>
<div class="paragraph">
<p>The <code>model</code> itself provides the following built-in properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>parent</code>: Model of the parent component or template.</p>
</li>
<li>
<p><code>root</code>: Top root model of the rendering process.</p>
</li>
<li>
<p><code>content</code>: Content node bound to the model in the rendering context
provided as a
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Templating+function+arguments+and+return+types#Templatingfunctionargumentsandreturntypes-NodeandContentMap">ContentMap</a>.</p>
</li>
<li>
<p><code>node</code>: Content node bound to the model in the rendering context
provided as a
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Templating+function+arguments+and+return+types#Templatingfunctionargumentsandreturntypes-NodeandContentMap">Node</a>.</p>
</li>
<li>
<p><code>definition</code>: The renderable definition (template, area or component)
bound to the model. Same as <code>def</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Within a FreeMarker template script, you reference this property as
follows:</p>
</div>
<div class="paragraph">
<p><code>[#assign parentTemplateDefintion = model.parent.definition /]</code></p>
</div>
<div class="paragraph">
<p>Combining a method of the parent model ( <code>#getPageInfo</code> ) and built-in
model properties:</p>
</div>
<div class="paragraph">
<p>` ${model.parent.getPageInfo(model.parent.content)}`</p>
</div>
<div class="paragraph">
<p>In a JavaScript model class, you must use <code>this</code> instead of <code>model</code> :</p>
</div>
<div class="paragraph">
<p><code>var<code> parentTemplateDefintion = </code>this`</code>.parent.definition;`</p>
</div>
<div class="paragraph">
<p>Click here to see a JS model class using the built-in model properties</p>
</div>
<div class="paragraph">
<p><code>var DemoModel = function () {</code></p>
</div>
<div class="paragraph">
<p>`    <code>`/**</code></p>
</div>
<div class="paragraph">
<p>`     * Whithin the model JS file, when using model properties, you must use &lt;code&gt;this&lt;/code&gt; to reference the model.`</p>
</div>
<div class="paragraph">
<p>`     */`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>.demonstrateBuiltInProperties = function () {`</p>
</div>
<div class="paragraph">
<p>`        var res = <code>"&lt;pre&gt;"</code>;`</p>
</div>
<div class="paragraph">
<p>`        res += <code>"Current Template name = &#8220;` +</code>this<code>.definition.name +<code>&#8221;\n"</code>;</code></p>
</div>
<div class="paragraph">
<p>`        res += <code>"Parent Template name = &#8220;` +</code>this<code>.parent.definition.name +<code>&#8221;\n"</code>;</code></p>
</div>
<div class="paragraph">
<p>`        res += <code>"Current node path = &#8220;` +</code>this<code>.content[</code>'@path'<code>]  +<code>&#8221;\n"</code>;</code></p>
</div>
<div class="paragraph">
<p>`        res += <code>"Parent node path = &#8220;` +</code>this<code>.parent.content[</code>'@path'<code>]  +<code>&#8221;\n"</code>;</code></p>
</div>
<div class="paragraph">
<p>`        res = ``"Page info by using method of the parent model: "`` <code>this</code>.parent.getPageInfo(<code>this</code>.parent.content)+<code>"\n"</code>;`</p>
</div>
<div class="paragraph">
<p>`        res += <code>"&lt;/pre&gt;"</code>;`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> res;`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>};</code></p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p><code>new`</code> DemoModel();`</p>
</div>
<div class="paragraph">
<p>Note the usage of the <code>parent</code> property, which is a handy pointer to the
parent model. With <code>parent</code> you have access to all properties and
methods defined on the parent model as well as to the built-in
properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-content"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-content"></a>content</h4>
<div class="paragraph">
<p>Current content node in the rendering context provided as a ContentMap.</p>
</div>
<div class="paragraph">
<p>In a page template, current node is the page node (<code>mgnl:page</code>). In a
component template, current node is the component node
(<code>mgnl:component</code>). It is the contextual "root" content node. The
current node is exposed as a
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Templating+function+arguments+and+return+types#Templatingfunctionargumentsandreturntypes-info.magnolia.jcr.util.ContentMap">ContentMap</a>
object, which means it carries the properties of the underlying
<a href="http://www.day.com/specs/jsr170/javadocs/jcr-2.0/javax/jcr/Node.html">Node</a>.</p>
</div>
<div class="paragraph">
<p>example</p>
</div>
<div class="paragraph">
<p><code>var`</code> pageTitle = content.title;`</p>
</div>
<div class="paragraph">
<p><code>var<code> nodePrimaryType = content[</code>"jcr:primaryType"`</code>];`</p>
</div>
<div class="paragraph">
<p><code>var<code> nodeType = content[</code>"@nodeType"<code>]; </code>// same as above)</code></p>
</div>
<div class="paragraph">
<p><code>var<code> name = content[</code>"@name"`</code>];`</p>
</div>
<div class="paragraph">
<p><code>var<code> id = content[</code>"@id"`</code>];`</p>
</div>
<div class="paragraph">
<p><code>var<code> path = content[</code>"@path"`</code>];`</p>
</div>
<div class="paragraph">
<p><code>var<code> depth = content[</code>"@depth"`</code>];`</p>
</div>
<div class="paragraph">
<p>The <code>content</code> object is a "map". You can access its properties via the
"dot notation" (line 1) or the "brackets notation" (line 2). The latter
is required if the property&#8217;s name contains a colon or a dot.</p>
</div>
<div class="paragraph">
<p>The <code>content</code> object also maps some always-existing properties with the
spacial delimiter <code>@</code> . These properties are <code>@name</code>, <code>@id</code> (same as
jcr:uuid), <code>@path</code>, <code>@depth</code>, and <code>@nodeType</code> (same as jcr:primaryType).</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-def"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-def"></a><span id="src-196596448_HowtoworkwithJavaScriptmodels-def2 " class="confluence-anchor-link">#</span>#</h4>

</div>
<div class="sect3">
<h4 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtZGVm4oCTdGVtcGxhdGVkZWZpbml0aW9u"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtZGVm4oCTdGVtcGxhdGVkZWZpbml0aW9u"></a>def – template definition</h4>
<div class="paragraph">
<p>Current RenderableDefinition . Use <code>def</code> to access the properties of the
template definition such as title, or
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Template+definition">custom
parameters</a>. It is a JavaBean, which means you can access its properties
with the "dot" operator or a getter method.</p>
</div>
<div class="paragraph">
<p>example</p>
</div>
<div class="paragraph">
<p><code>var`</code> templateTitle = def.title;`</p>
</div>
<div class="paragraph">
<p><code>var<code> myColor = (def.parameters &amp;&amp; def.parameters.color &amp;&amp; </code>""<code>!=def.parameters.color) ? def.parameters.color : </code>"red"`</code>;`</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtY3R44oCTY29udGV4dA"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtY3R44oCTY29udGV4dA"></a>ctx – context</h4>
<div class="paragraph">
<p>Context represents the environment in which the current process runs.
The type is Context. It is a WebContext when the script is executed from
a Web page and SimpleContext for instance when the script generates a
mail from within a workflow or scheduled job.</p>
</div>
<div class="paragraph">
<p>More information</p>
</div>
<div class="paragraph">
<p>The Context interface provides access to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>user</code> (User)</p>
</li>
<li>
<p><code>locale</code>
(<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Locale.html">java.util.Locale</a>)</p>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please note that <code>${ctx.locale}</code> is different from
<code>${cmsfn.language()}</code>, the former referring to the locale currently used
by the user, the latter to the locale currently used by the site. See
also
<a href="https://wiki.magnolia-cms.com/display/DOCS62/AdminCentral+and+public+locales">AdminCentral
and public locales</a>.</p>
</div>
<div class="paragraph">
<p>In addition, WebContext provides access to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>aggregationState</code> (AggregationState)</p>
</li>
<li>
<p><code>contextPath</code> (current context path)</p>
</li>
<li>
<p><code>request</code> (<code>javax.servlet.http.HttpServletRequest</code>)</p>
</li>
<li>
<p><code>servletContext</code> (<code>javax.servlet.ServletContext</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WebContext properties are null if the execution is not a Web page
request.</p>
</div>
<div class="paragraph">
<p>example</p>
</div>
<div class="paragraph">
<p><code>var`</code> userName = ctx.user.name;`</p>
</div>
<div class="paragraph">
<p><code>var`</code> locale = ctx.locale;`</p>
</div>
<div class="paragraph">
<p><code>var`</code> contextPath = ctx.contextPath;`</p>
</div>
<div class="paragraph">
<p><code>var`</code> servletContext = ctx.servletContext;`</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtc3RhdGXigJNhZ2dyZWdhdGlvbnN0YXRl"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtc3RhdGXigJNhZ2dyZWdhdGlvbnN0YXRl"></a>state – aggregation state</h4>
<div class="paragraph">
<p>The current AggregationState. Only set if ctx is of type WebContext.
(See above.) It is a shortcut for <code>ctx.aggregationState</code>.</p>
</div>
<div class="paragraph">
<p>More infos</p>
</div>
<div class="paragraph">
<p>Provides access to many properties as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>channel</code> (Channel)</p>
</li>
<li>
<p><code>originalURI</code></p>
</li>
<li>
<p><code>currentURI</code></p>
</li>
<li>
<p><code>queryString</code></p>
</li>
<li>
<p><code>mainContentNode</code>
(<a href="https://docs.adobe.com/docs/en/spec/jsr170/javadocs/jcr-2.0/javax/jcr/Node.html">javax.jcr.Node</a>)</p>
</li>
<li>
<p><code>templateName</code></p>
</li>
<li>
<p><code>locale</code> (the same as <code>ctx.locale</code>)</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Read the javadoc (AggregationState) for all the properties.</p>
</div>
<div class="paragraph">
<p>Please note that the values of all the properties are HTML-escaped by
default. Should you need it, the raw (unescaped) data can still be
accessed in the following manner:</p>
</div>
<div class="paragraph">
<p><code>${state.unwrap().originalURI}</code></p>
</div>
<div class="paragraph">
<p>However, be warned that this may expose your webapp to XSS attacks.</p>
</div>
<div class="paragraph">
<p>example</p>
</div>
<div class="paragraph">
<p><code>var`</code> currentURI = state.currentURI;`</p>
</div>
<div class="paragraph">
<p><code>var`</code> queryString = state.queryString;`</p>
</div>
<div class="paragraph">
<p><code>var`</code> channelName = state.channel.name;`</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtaTE4buKAk3NpbXBsZXRyYW5zbGF0b3Jmb3Jsb2NhbGl6ZWRjb250ZW50"><a class="anchor" href="#src-196596448_safe-id-SG93dG93b3Jrd2l0aEphdmFTY3JpcHRtb2RlbHMtaTE4buKAk3NpbXBsZXRyYW5zbGF0b3Jmb3Jsb2NhbGl6ZWRjb250ZW50"></a>i18n – simple translator for localized content</h4>
<div class="paragraph">
<p>The <code>i18n</code> is an object of the SimpleTranslator type. It provides access
to all the <a href="https://wiki.magnolia-cms.com/display/DOCS62/i18n+API">message
bundles</a> which have been loaded into the system. Use the <code>#translate</code>
method to get a localized value identified by a key. You can provide
more String arguments to the method in order to replace the placeholders
(<code>{}</code>) in the translation.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>message-bundle snippet</p>
</div>
<div class="paragraph">
<p><code>javascript-model-samples.frontend.footer.arbitraryWisdom = You make your own luck</code></p>
</div>
<div class="paragraph">
<p><code>javascript-model-samples.frontend.footer.happinessLevel = Random happiness level: {0}%</code></p>
</div>
<div class="paragraph">
<p>JavaScript model snippet</p>
</div>
<div class="paragraph">
<p><code>var<code> localizedText = i18n.translate(</code>"javascript-model-samples.frontend.footer.arbitraryWisdom"`</code>);`</p>
</div>
<div class="paragraph">
<p><code>var<code> localizedText2 = i18n.translate(</code>"javascript-model-samples.frontend.footer.happinessLevel"<code>, </code>"95"`</code>);`</p>
</div>
<div class="paragraph">
<p>[<mark>src-196596448_HowtoworkwithJavaScriptmodels-templating-functions]</mark>#</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_HowtoworkwithJavaScriptmodels-EnablingandusingtemplatingfunctionsforJSmodels"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-EnablingandusingtemplatingfunctionsforJSmodels"></a>Enabling and using templating functions for JS models</h3>
<div class="paragraph">
<p><a href="https://wiki.magnolia-cms.com/display/DOCS62/Templating+functions">Templating
functions</a> were built mainly to be used within template scripts
directly, but they can also be very handy within JavaScript models. In
the default configuration of <code>magnolia-module-javascript-models</code>,
templating functions are not enabled.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>To give more power to your JavaScript models, enable the
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Templating+functions">templating
functions</a> to access and search JCR content, such as `cmsfn `, `damfn `,
`searchfn `and similar.</p>
</div>
<div class="paragraph">
<p>[<mark>src-196596448_HowtoworkwithJavaScriptmodels-enabling-templating-functions]</mark>#</p>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-Enablingtemplatingfunctions"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-Enablingtemplatingfunctions"></a>Enabling templating functions</h4>
<div class="paragraph">
<p>Edit the configuration of the module with the
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Configuration+app">Configuration
app</a>. For each templating function you want to use, add an entry at
<code>/modules/javascript-models/config/engineConfiguration/exposedComponents</code>
.</p>
</div>
<div class="paragraph">
<p>Click here to expand to see the configuration tree</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javascript-models</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">engineConfiguration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exposedComponents</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>cmsfn</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cmsfn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.magnolia.templating.functions.TemplatingFunctions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>damfn</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">damfn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">componentClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.magnolia.dam.templating.functions.DamTemplatingFunctions</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The stock configuration of the module shows just the version of the
module. You have to create the subtree starting with the folder
<code>/modules/javascript-models/config</code> .</p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-UsingtemplatingfunctionsinaJavaScriptmodel"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-UsingtemplatingfunctionsinaJavaScriptmodel"></a>Using templating functions in a JavaScript model</h4>
<div class="paragraph">
<p>Once a templating function is enabled, use it in the JavaScript code of
the model.</p>
</div>
<div class="paragraph">
<p><strong>Example: Breadcrumb navigation using <code>cmsfn#ancestors</code></strong></p>
</div>
<div class="paragraph">
<p>JS snippet from the model class</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>.renderBreadcrumbs = <code>function</code> (pageNode) {`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> res = i18n.translate(<code>'javascript-model-samples.frontend.breadcrumbs.start.label'</code>);`</p>
</div>
<div class="paragraph">
<p>`        cmsfn.ancestors(pageNode).forEach(<code>function</code> (anchestorPage) {`</p>
</div>
<div class="paragraph">
<p>`            res += <code>'&lt;span&gt;&lt;a href="&#8216;` + cmsfn.link(anchestorPage) + <code>&#8217;"&gt;'</code> + evalBreadcrumbItitle(anchestorPage) + <code>'&lt;/a&gt;&lt;/span&gt;&lt;span&gt;&gt;&gt;&lt;/span&gt;'</code>;</code></p>
</div>
<div class="paragraph">
<p>`        });`</p>
</div>
<div class="paragraph">
<p>`        res += <code>'&lt;span&gt;'</code> + evalBreadcrumbItitle(pageNode) + <code>'&lt;/span&gt;'</code>;`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> res;`</p>
</div>
<div class="paragraph">
<p>`    };`</p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p>`    <code>function</code> evalBreadcrumbItitle(pageNode) {`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> (pageNode.navigationTitle) ? pageNode.navigationTitle : (pageNode.title) ? pageNode.title : pageNode[<code>"@name"</code>];`</p>
</div>
<div class="paragraph">
<p>`    }``//-`</p>
</div>
<div class="paragraph">
<p>The method <code>#renderBreadcrumbs</code> expects a page node as the argument.</p>
</div>
<div class="paragraph">
<p>Here is the method call within a page template script:</p>
</div>
<div class="paragraph">
<p><code>&lt;div <code>class</code>=<code>"breadcrumbs"</code>&gt;</code></p>
</div>
<div class="paragraph">
<p>`  ${model.renderBreadcrumbs(content)}`</p>
</div>
<div class="paragraph">
<p><code>&lt;/div&gt;</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_HowtoworkwithJavaScriptmodels-CreatingacustomformprocessorwithJavaScript"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-CreatingacustomformprocessorwithJavaScript"></a>Creating a custom form processor with JavaScript</h3>
<div class="paragraph">
<p>JavaScript can also be used for processing forms created by Magnolia&#8217;s
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Form+module">Form Module</a>
(see also <a href="https://wiki.magnolia-cms.com/display/DOCS62/Form+module">Form
module creating a custom form processor</a>). Below is the form definition
and the JavaScript based form processor for a form in order to create a
new contact in the <code>contacts</code> workspace.</p>
</div>
<div class="paragraph">
<p>The complete example is available on
<a href="https://git.magnolia-cms.com/projects/LIGHT-MODULES/repos/javascript-model-samples">bitbucket</a>.</p>
</div>
<div class="paragraph">
<p><strong>YAML definition of the form component:</strong></p>
</div>
<div class="paragraph">
<p>/javascript-model-samples/raw/templates/components/form.yaml</p>
</div>
<div class="paragraph">
<p><code>i18nBasename: info.magnolia.module.form.messages</code></p>
</div>
<div class="paragraph">
<p><code>dialog: form:form</code></p>
</div>
<div class="paragraph">
<p><code>description: paragraph.form.description</code></p>
</div>
<div class="paragraph">
<p><code>modelClass: info.magnolia.module.form.templates.components.FormModel</code></p>
</div>
<div class="paragraph">
<p><code>renderType: freemarker</code></p>
</div>
<div class="paragraph">
<p><code>title: Form with Javascript Form Processor</code></p>
</div>
<div class="paragraph">
<p><code>templateScript: /form/components/form.ftl</code></p>
</div>
<div class="paragraph">
<p><code>class`</code>: info.magnolia.module.form.templates.components.FormParagraph`</p>
</div>
<div class="paragraph">
<p><code>formProcessors:</code></p>
</div>
<div class="paragraph">
<p>`  - name: saveContact`</p>
</div>
<div class="paragraph">
<p>`    enabled: <code>`true</code></p>
</div>
<div class="paragraph">
<p>`    <code>class</code>: info.magnolia.module.jsmodels.form.JavascriptFormProcessor`</p>
</div>
<div class="paragraph">
<p>`    formProcessorScriptPath: /javascript-model-samples/templates/js/formProcessors/saveContact.js`</p>
</div>
<div class="paragraph">
<p><code>parameters:</code></p>
</div>
<div class="paragraph">
<p>`  formEnctype: multipart/form-data`</p>
</div>
<div class="paragraph">
<p><code>areas:</code></p>
</div>
<div class="paragraph">
<p>`  fieldsets:`</p>
</div>
<div class="paragraph">
<p>`    description: areas.components.form.fieldsets.description`</p>
</div>
<div class="paragraph">
<p>`    type: list`</p>
</div>
<div class="paragraph">
<p>`    title: areas.components.form.fieldsets.title`</p>
</div>
<div class="paragraph">
<p>`    enabled: <code>`true</code></p>
</div>
<div class="paragraph">
<p>`    templateScript: /form/generic/listArea.ftl`</p>
</div>
<div class="paragraph">
<p>`    availableComponents:`</p>
</div>
<div class="paragraph">
<p>`      formGroupFields:`</p>
</div>
<div class="paragraph">
<p>`        id: form:components/formGroupFields`</p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 12: The <code>class</code> property must have the value
<code>info.magnolia.module.jsmodels.form.JavascriptFormProcessor</code> , this
definition class enables the usage of a JavaScript based form processor
(whose path is defined on the next line).</p>
</li>
<li>
<p>Line 13: The <code>formProcessorScriptPath</code> property contains the path to
the JavaScript of the processor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>JavaScript-based form processor:</strong></p>
</div>
<div class="paragraph">
<p>/javascript-model-samples/raw/templates/js/formProcessors/saveContact.js</p>
</div>
<div class="paragraph">
<p><code>/**</code></p>
</div>
<div class="paragraph">
<p>` * Form processor that creates new contact in contacts workspace.`</p>
</div>
<div class="paragraph">
<p>` * @constructor`</p>
</div>
<div class="paragraph">
<p>` */`</p>
</div>
<div class="paragraph">
<p><code>var<code> Processor = </code>function`</code> () {`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>.process = <code>function</code> (content, parameters) {`</p>
</div>
<div class="paragraph">
<p>`        <code>this</code>._saveContact(parameters, ctx.getPostedForm().getDocument(<code>"photo"</code>))`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>`    <code>`/**</code></p>
</div>
<div class="paragraph">
<p>`     * Formats contact name.`</p>
</div>
<div class="paragraph">
<p>`     *`</p>
</div>
<div class="paragraph">
<p>`     * @param firstName`</p>
</div>
<div class="paragraph">
<p>`     * @param lastName`</p>
</div>
<div class="paragraph">
<p>`     * @returns {string}`</p>
</div>
<div class="paragraph">
<p>`     * @private`</p>
</div>
<div class="paragraph">
<p>`     */`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>._contactName = <code>function</code> (firstName, lastName) {`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> contactName = firstName.substring(0, 1) + lastName.replace(/ /g,<code>""</code>);`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> contactName.toLowerCase();`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>`    <code>`/**</code></p>
</div>
<div class="paragraph">
<p>`     * Creates resource node under contact containing the uploaded photo.`</p>
</div>
<div class="paragraph">
<p>`     *`</p>
</div>
<div class="paragraph">
<p>`     * @param contact`</p>
</div>
<div class="paragraph">
<p>`     * @param document`</p>
</div>
<div class="paragraph">
<p>`     * @private`</p>
</div>
<div class="paragraph">
<p>`     */`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>._createBinary = <code>function</code> (contact, document) {`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> resource = contact.addNode(<code>"photo"</code>, <code>"mgnl:resource"</code>);`</p>
</div>
<div class="paragraph">
<p>`        resource.setProperty(<code>"fileName"</code>, document.getFileName());`</p>
</div>
<div class="paragraph">
<p>`        resource.setProperty(<code>"extension"</code>, document.getExtension());`</p>
</div>
<div class="paragraph">
<p>`        resource.setProperty(<code>"jcr:mimeType"</code>, document.getType());`</p>
</div>
<div class="paragraph">
<p>`        resource.setProperty(<code>"jcr:data"</code>, document.getStream());`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p>`    <code>`/**</code></p>
</div>
<div class="paragraph">
<p>`     * Saves contact into contacts workspace.`</p>
</div>
<div class="paragraph">
<p>`     * This method does not check for illegal characters or if generated name is unique - for sake of simplicity.`</p>
</div>
<div class="paragraph">
<p>`     *`</p>
</div>
<div class="paragraph">
<p>`     * @param values`</p>
</div>
<div class="paragraph">
<p>`     * @param document`</p>
</div>
<div class="paragraph">
<p>`     * @returns {boolean}`</p>
</div>
<div class="paragraph">
<p>`     * @private`</p>
</div>
<div class="paragraph">
<p>`     */`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>._saveContact = <code>function</code> (values, document) {`</p>
</div>
<div class="paragraph">
<p>`        <code>try</code> {`</p>
</div>
<div class="paragraph">
<p>`            <code>var</code> contact = ctx.getJCRSession(<code>"contacts"</code>).getRootNode().addNode(<code>this</code>._contactName(values.firstName, values.lastName), <code>"mgnl:contact"</code>);`</p>
</div>
<div class="paragraph">
<p>`            contact.setProperty(<code>"firstName"</code>, values.firstName);`</p>
</div>
<div class="paragraph">
<p>`            contact.setProperty(<code>"lastName"</code>, values.lastName);`</p>
</div>
<div class="paragraph">
<p>`            contact.setProperty(<code>"organizationName"</code>, values.organization);`</p>
</div>
<div class="paragraph">
<p>`            contact.setProperty(<code>"email"</code>, values.email);`</p>
</div>
<div class="paragraph">
<p>`            <code>this</code>._createBinary(contact, document);`</p>
</div>
<div class="paragraph">
<p>`            contact.getSession().save();`</p>
</div>
<div class="paragraph">
<p>`            <code>return</code> <code>true</code>;`</p>
</div>
<div class="paragraph">
<p>`        } <code>catch</code> (e) {`</p>
</div>
<div class="paragraph">
<p>`            <code>return</code> <code>false</code>;`</p>
</div>
<div class="paragraph">
<p>`        }`</p>
</div>
<div class="paragraph">
<p>`    };`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p><code>new`</code> Processor();`</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_HowtoworkwithJavaScriptmodels-Loadingscriptstothemodel"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-Loadingscriptstothemodel"></a>Loading scripts to the model</h3>
<div class="paragraph">
<p>You can load other JavaScript files in the Javascript model file. This
is handy when reusing JavaScript classes in several models. There are
two possibilites to load a script. In both cases, load the script at the
top of model file.</p>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-LoadingascriptasaMagnoliaresourcewithloadScript"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-LoadingascriptasaMagnoliaresourcewithloadScript"></a>Loading a script as a Magnolia resource with loadScript</h4>
<div class="paragraph">
<p>We recommend using <code>loadScript</code> if the JavaScript is a
<a href="Resources.html">Magnolia resource</a>. It can then load it
independently of its <a href="Resources.html">origin</a>. When referencing the
script, the path is absolute and has to start with the module name.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p><code>loadScript(<code>"/javascript-model-samples/templates/js/utils.js"</code>);</code></p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-Loadingascriptfromthefilesystemwithload"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-Loadingascriptfromthefilesystemwithload"></a>Loading a script from the filesystem with load</h4>
<div class="paragraph">
<p>A Nashorn built-in feature, <code>load</code> can be used to load a script with
<code>http</code> . When using it for files of Magnolia modules, both the
JavaScript model file and the file to be included must be available on
the filesystem. Combine it with the built-in <code><em>PATH</em></code> variable, which
is the absolute path to the parent directory of the current model file.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="paragraph">
<p><code>load(<em>PATH</em> + <code>"/../js/utils.js"</code>);</code></p>
</div>
<div class="paragraph">
<p><code>load(<code>"https://cdnjs.cloudflare.com/ajax/libs/validate.js/0.11.1/validate.min.js"</code>);</code></p>
</div>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-Acompleteexample"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-Acompleteexample"></a>A complete example</h4>
<div class="paragraph">
<p>Below is a complete example showing how to use the included script.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="paragraph">
<p>The file to be loaded:</p>
</div>
<div class="paragraph">
<p><code>var<code> Utils = </code>function`</code> () {`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>.formatDate = <code>function</code> (calendarObject) {`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> date = <code>new</code> Date(calendarObject.getTimeInMillis());`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> datestring = date.getFullYear() + <code>"-"</code> +`</p>
</div>
<div class="paragraph">
<p>`            (<code>"0"</code> + (date.getMonth() + 1)).slice(-2) + <code>"-"</code> +`</p>
</div>
<div class="paragraph">
<p>`            (<code>"0"</code> + date.getDate()).slice(-2) + <code>"-"</code> +`</p>
</div>
<div class="paragraph">
<p>`            (<code>"0"</code> + date.getHours()).slice(-2) + <code>":"</code> +`</p>
</div>
<div class="paragraph">
<p>`            (<code>"0"</code> + date.getMinutes()).slice(-2);`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> datestring;`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p>The model which is loading and using the above script:</p>
</div>
<div class="paragraph">
<p><code>loadScript(<code>"/javascript-model-samples/templates/js/utils.js"</code>);</code></p>
</div>
<div class="paragraph">
<p><code>var<code> MyModel = </code>function`</code> () {`</p>
</div>
<div class="paragraph">
<p>`    <code>var</code> utils = <code>new</code> Utils();`</p>
</div>
<div class="paragraph">
<p>`    <code>this</code>.getPageInfo = <code>function</code> (pageNode) {`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> pageCreator = pageNode[<code>"mgnl:createdBy"</code>];`</p>
</div>
<div class="paragraph">
<p>`        <code>var</code> modificationDate = utils.formatDate(pageNode[<code>"mgnl:lastModified"</code>]);`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> i18n.translate(<code>"javascript-model-samples.frontend.footer.pageInfo.label"</code>, pageCreator, modificationDate);`</p>
</div>
<div class="paragraph">
<p>`    };`</p>
</div>
<div class="paragraph">
<p><code>};</code></p>
</div>
<div class="paragraph">
<p><code>new`</code> MyModel();`</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1: Load the external script with a JavaScript class.</p>
</li>
<li>
<p>Line 4: Create an instance of the external script&#8217;s class.</p>
</li>
<li>
<p>Line 8: Use the instance method of the external class.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_HowtoworkwithJavaScriptmodels-Exposingothercomponents"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-Exposingothercomponents"></a>Exposing other components</h3>
<div class="paragraph">
<p>You can expose any other component in the same way as
<a href="#src-196596448_HowtoworkwithJavaScriptmodels-enabling-templating-functions">enabling
the templating functions</a>, see
<a href="https://wiki.magnolia-cms.com/display/DOCS62/JavaScript+Models+module">JavaScript
Models module - Exposing components</a>. A component is a Java class (or an
interface for which a type mapping exists within the framework) having a
default constructor that can be resolved and instantiated by the IoC
framework.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
This is a very powerful mechanism and should be used carefully.
Fortunately, its power can be limited
by<a href="#src-196596448_HowtoworkwithJavaScriptmodels-limiting-access-to-java-api"> restricting
access to the Java API</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596448_HowtoworkwithJavaScriptmodels-RestrictingaccesstotheJavaAPI"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-RestrictingaccesstotheJavaAPI"></a>Restricting access to the Java API</h3>
<div class="paragraph">
<p>The module provides two ways to limit the "power" of a JavaScript model.</p>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-DisablingNashornextensionsandJavasyntaxextensions"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-DisablingNashornextensionsandJavasyntaxextensions"></a>Disabling Nashorn extensions and Java syntax extensions</h4>
<div class="paragraph">
<p>There are two Nashorn engine options to limit the power:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--no-java</code> turns off Java specific syntax extensions like "Java",
"Packages", etc.</p>
</li>
<li>
<p><code>--no-syntax-extensions</code> makes sure that only standard ECMAScript
syntax is supported, disabling the
<a href="https://wiki.openjdk.java.net/display/Nashorn/Nashorn+extensions">Nashorn
extensions</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click here to expand to see the configuration to disable Nashorn
extension</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javascript-models</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">engineConfiguration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">engineOptions</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--no-java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--no-java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--no-syntax-extensions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--no-syntax-extensions</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="src-196596448_HowtoworkwithJavaScriptmodels-UsingclassfiltertoexcludeinstantiationofsomeJavaclasses"><a class="anchor" href="#src-196596448_HowtoworkwithJavaScriptmodels-UsingclassfiltertoexcludeinstantiationofsomeJavaclasses"></a>Using class filter to exclude instantiation of some Java classes</h4>
<div class="paragraph">
<p>To interpret JavaScript, Nashorn creates a compiled version of a JS
model. When the script is executed, Nashorn instantiates Java classes.
With a class filter you can exclude Java classes which you do <em>not</em> want
to be instantiated. The class filter must implement
`dk.nashorn.api.scripting.ClassFilter `.</p>
</div>
<div class="paragraph">
<p>The filter is applied when you explicitly use the types in the Nashorn
code, for instance, with the expression <code>Java.type("myType")</code> . The
filter is not applied when you assign an object to a Nashorn variable
without explicitly mentioning the type.</p>
</div>
<div class="paragraph">
<p>If the filter prevents the usage of a class – technically speaking, if
the filter returns <code>false</code> – Nashorn then handles this case as a
<code>java.lang.ClassNotFoundException</code> which leads to a
<code>java.lang.RuntimeException</code> .</p>
</div>
<div class="paragraph">
<p>Click here to expand to see the configuration to apply a class filter</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javascript-models</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">engineConfiguration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classFilter</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.magnolia.documentation.nashorn.filter.MyFilter</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="paragraph">
<p>Java class filter code:</p>
</div>
<div class="paragraph">
<p><code>package`</code> info.magnolia.documentation.nashorn.filter;`</p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p><code>import`</code> java.util.GregorianCalendar;`</p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p><code>/**</code></p>
</div>
<div class="paragraph">
<p>` * A simple class filter to demonstrate the nashorn class filter abilities.`</p>
</div>
<div class="paragraph">
<p>` */`</p>
</div>
<div class="paragraph">
<p><code>public<code> </code>class<code> MyFilter </code>implements`</code> jdk.nashorn.api.scripting.ClassFilter {`</p>
</div>
<div class="paragraph">
<p>`    <code>`@Override</code></p>
</div>
<div class="paragraph">
<p>`    <code>public</code> <code>boolean</code> exposeToScripts(String fullyQualifiedClassName) {`</p>
</div>
<div class="paragraph">
<p>`        <code>if</code>(fullyQualifiedClassName.startsWith(<code>"javax.jcr"</code>)`</p>
</div>
<div class="paragraph">
<p>`                || fullyQualifiedClassName.equals(System.<code>class</code>.getName())`</p>
</div>
<div class="paragraph">
<p>`                || fullyQualifiedClassName.equals(GregorianCalendar.<code>class</code>.getName())){`</p>
</div>
<div class="paragraph">
<p>`            <code>return</code> <code>false</code>;`</p>
</div>
<div class="paragraph">
<p>`        }<code>else</code>{`</p>
</div>
<div class="paragraph">
<p>`            <code>return</code> <code>true</code>;`</p>
</div>
<div class="paragraph">
<p>`        }`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>}</code></p>
</div>
<div class="paragraph">
<p>Nashorn code:</p>
</div>
<div class="paragraph">
<p><code>this<code>.test = </code>function`</code> () {`</p>
</div>
<div class="paragraph">
<p>`    <code>var</code> sytemTime = Java.type(<code>"java.lang.System"</code>).currentTimeMillis();`</p>
</div>
<div class="paragraph">
<p>`    <code>return</code> sytemTime;`</p>
</div>
<div class="paragraph">
<p><code>};</code></p>
</div>
<div class="paragraph">
<p><code>this<code>.test2 = </code>function`</code> (myObject) {`</p>
</div>
<div class="paragraph">
<p>`    <code>if</code> (myObject <code>instanceof</code> Java.type(<code>"java.util.GregorianCalendar"</code>)) {`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> utils.formatDate(myObject)`</p>
</div>
<div class="paragraph">
<p>`    }<code>else</code>{`</p>
</div>
<div class="paragraph">
<p>`        <code>return</code> myObject;`</p>
</div>
<div class="paragraph">
<p>`    }`</p>
</div>
<div class="paragraph">
<p><code>};</code></p>
</div>
<div class="paragraph">
<p><code>this<code>.test3 = </code>function`</code> (workspaceName) {`</p>
</div>
<div class="paragraph">
<p>`    <code>var</code> jcrSession = ctx.getJCRSession(workspaceName);`</p>
</div>
<div class="paragraph">
<p>`    <code>`return</code></p>
</div>
<div class="paragraph">
<p><code>};</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The filter is applied when calling the <code>#test</code> and <code>#test2</code> methods
(see lines 2, 7 in the Nashorn code above).</p>
</li>
<li>
<p>The filter is <em>not</em> applied when calling the <code>#test3</code> method, although
on line 14 Nashorn assigns an object of the type javax.jcr.Session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How to use Magnolia Maven archetypes</p>
</div>
<div class="paragraph">
<p>Best practices</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">PAGE CONTENTS</h3>
    <div id="article-toc"></div>
</aside>
<script>
    var clipboard = new ClipboardJS('.btn');

    clipboard.on('success', function (e) {
        console.log(e);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>
</main>
</div>
<footer class="footer">
    <p> &copy; <span id="year"></span> <a href="http://www.magnolia-cms.com" target="_blank"
        title="Link to Magnolia's official website" class="footer-link">Magnolia CMS</a></p>
    
    <div class="footer-bottom">
      <hr class="footer-hr">
    </div>

    <div class="bottom-icons">
      <a href="https://www.facebook.com/Magnolia" target="_blank" title="Magnolia's Facebook Page"><i class="fa fa-facebook fa-2x" aria-hidden="true"></i></a> <a href="https://twitter.com/magnolia_cms" target="_blank" title="Magnolia's Twitter Page"><i class="fa fa-twitter fa-2x" aria-hidden="true"></i></a> <a href="https://www.linkedin.com/company/magnolia-cms/" target="_blank" title="Magnolia's LinkedIn Page"><i
        class="fa fa-linkedin fa-2x" aria-hidden="true"></i></a>
    </div>

    <div class="bottom-logo">

    </div>

</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script>
    document.getElementById("year").innerHTML = new Date().getFullYear();
</script>

<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3, h4, h5',
        collapseDepth: 3,
        positionFixedSelector: null,
        scrollSmooth: true,
        scrollSmoothDuration: 420
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>

 <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
      appId: '89ZVZ4S26W',
      apiKey: 'a797119372b8a613eb38a9564867085c',
      indexName: 'dev_DOCS',
      inputSelector: '#searchBar',
      algoliaOptions: { hitsPerPage: 10 },
    });
  </script>
  </body>
</html>
