<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How to use Multisite - Magnolia 6.2 documentation :: Magnolia CMS Docs</title>
    <link rel="canonical" href="http://localhost:9096/magnolia-docs/core/templating/How_to_use_Multisite.html">
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="">
        <img class="logo" src="../../../_/img/magnolia-medium.png" style="width: 10rem; height:auto; margin-left:0.8rem; margin-top:0.4rem;" alt="Magnolia">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Releases</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Core</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Getting Started</a>
            <a class="navbar-item" href="#">Features</a>
            <a class="navbar-item" href="#">Developing</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Cloud</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Getting Started</a>
            <a class="navbar-item" href="#">Features</a>
            <a class="navbar-item" href="#">Cloud Light Development</a>
            <a class="navbar-item" href="#">Upgrading in the Cloud</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Headless</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Getting Started</a>
            <a class="navbar-item" href="#">Visual SPA Editor</a>
            <a class="navbar-item" href="#">API</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.magnolia-cms.com/get-started">Get Magnolia</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
  <div class="lower-head">
    
  </div>
</header>
<div class="body">
<div class="nav-container" data-component="magnolia-docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Get Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started/hello-magnolia.html">Hello Magnolia</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../cloud/getting-started/hello-cloud.html">Hello Magnolia Cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dump</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../releases/Releases.html">Releases</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../upgrade/Upgrading-to-Magnolia-6.2.x.html">Upgrading-to-Magnolia-6.2.x</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/Features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../cloud/Magnolia-Cloud.html">Cloud</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../administration/Administration.html">Administration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../developing/Developing.html">Developing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Templating.html">Templating</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../modules/Modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../authoring/Authoring.html">Authoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Logging_in.html">Logging in</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Editing_pages.html">Editing pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Managing_pages.html">Managing pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Editing_images.html">Editing images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Managing_assets.html">Managing assets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Publishing.html">Publishing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Deleting_and_restoring.html">Deleting and restoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Versioning.html">Versioning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Keyboard_shortcuts.html">Keyboard shortcuts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../authoring/Feeds.html">Feeds</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../connector-packs/Connector_Packs.html">Connector Packs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../apps/Apps.html">Apps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cli/Magnolia-CLI.html">Command Line Interface</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/Magnolia-CLI-v3.html">Magnolia CLI v3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/Updating-CLI-to-v3.html">Updating CLI to v3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/Magnolia-CLI-v2.html">Magnolia CLI v2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../cli/Magnolia-CLI-walkthrough.html">Magnolia CLI walkthrough</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../special-features/Special-Features.html">Special Features</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../support/Support.html">Need Support?</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Magnolia Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Magnolia Documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">master</a>
        </li>
        <li class="version">
          <a href="../../6.2.1/index.html">6.2.1</a>
        </li>
        <li class="version">
          <a href="../../6.2/index.html">6.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">master</button>
  <div class="version-menu">
    <a class="version is-current" href="How_to_use_Multisite.html">master</a>
    <a class="version" href="../../6.2.1/core/templating/How_to_use_Multisite.html">6.2.1</a>
    <a class="version is-missing" href="../../6.2/index.html">6.2</a>
  </div>
</div>
  <a href="../../releases/Releases.html" class="home-link"></a>

<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Magnolia Documentation</a></li>
    <li><a href="How_to_use_Multisite.html">How to use Multisite - Magnolia 6.2 documentation</a></li>
  </ul>
</nav>

</div>
  <div class="content">
<article class="doc">
<h1 class="page">How to use Multisite - Magnolia 6.2 documentation</h1>
<div id="preamble">
<div class="sectionbody">
<div id="ht-loader" class="paragraph">
<p>This content cannot be displayed without JavaScript.<br>
Please enable JavaScript and reload the page.</p>
</div>
<div class="paragraph">
<p><a href="" class="bare"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docs62"><a class="anchor" href="#_docs62"></a><span class="ht-logo-label">DOCS62</span> <span class="image"><img src="../../_images/DOCS62.png" alt="image"></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="Templating.html" class="bare">Templating.html</a></p>
</div>
<div class="sect2">
<h3 id="_magnolia_6_2_documentation"><a class="anchor" href="#_magnolia_6_2_documentation"></a>Magnolia 6.2 documentation</h3>
<div id="ht-sidebar-dragbar" class="paragraph">
<p><span class="drag-handle-1"> [.drag-handle-2]</span> [.drag-handle-3]##</p>
</div>
<div id="ht-breadcrumb" class="ulist">
<ul>
<li>
<p><a href="Templating.html">Magnolia 6.2 documentation</a></p>
</li>
<li>
<p><a href="Site_definition.html">Site definition</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675"><a class="anchor" href="#src-196596675"></a>How to use Multisite</h2>
<div class="sectionbody">
<div id="main-content" class="paragraph">
<p>Multisite examples</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="Multisite_example_-_Two_sites_with_different_domains.html">Two
sites with different domains</a></p>
</li>
<li>
<p><a href="Multisite_example_-_Minisite_using_URL_prefix_and_domain.html">Minisite
using URL prefix and domain</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Related pages</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.magnolia-cms.com/display/DOCS62/Multisite+module">Multisite
module</a></p>
</li>
<li>
<p><a href="Site_definition.html">Site definition</a></p>
</li>
<li>
<p><a href="https://wiki.magnolia-cms.com/display/WIKI/Apache+httpd+in+front+of+Tomcat+on+a+local+dev+machine">Apache
httpd in front of Tomcat</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This page and its subpages explain how to use the
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Multisite+module">Multisite
module</a> to set up and run multiple websites from one Magnolia
installation.</p>
</div>
<div class="paragraph">
<p>Site limitation</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>In DX Core, the number of sites that can be used is defined by the
number of sites purchased.</p>
</div>
<div class="paragraph">
<p>In the Community Edition, you can only create and use one site.</p>
</div>
<div class="paragraph">
<p>The page presents a few typical use cases for a multisite setup and the
corresponding configuration required. Full working examples of certain
use cases are in the subpages. We assume that you already know some
basics about a Magnolia <a href="Site_definition.html">site definition</a>.</p>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Overview"><a class="anchor" href="#src-196596675_HowtouseMultisite-Overview"></a>Overview</h3>
<div class="sect3">
<h4 id="src-196596675_HowtouseMultisite-Typicalusecases"><a class="anchor" href="#src-196596675_HowtouseMultisite-Typicalusecases"></a>Typical use cases</h4>
<div class="paragraph">
<p>Using multisite makes sense in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have
<a href="Multisite_example_-_Two_sites_with_different_domains.html">multiple
websites with completely different purposes</a>.</p>
</li>
<li>
<p>You have
<a href="Multisite_example_-_Minisite_using_URL_prefix_and_domain.html">minisites
and run campaigns</a>.</p>
</li>
<li>
<p>You have different websites for subsidiaries and country branches.</p>
</li>
<li>
<p>You have localized versions of the same website</p>
</li>
<li>
<p>You use handles and URI prefixes to get shorter URLs.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="src-196596675_HowtouseMultisite-Howmultisiteworks"><a class="anchor" href="#src-196596675_HowtouseMultisite-Howmultisiteworks"></a>How multisite works</h4>
<div class="paragraph">
<p>In the Multisite module, you configure two important elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Site definitions</strong><br>
The Multisite module is delivered with one default site definition
called <code>fallback</code>. When developing your multisite project, you configure
your own site definitions. Every site definition can have its own
<a href="Theme.html">theme</a> and <a href="Template_prototype.html">template
prototype</a>. A site definition contains a domain mapping and mapping to a
node in a repository (URI2RepositoryMapping).</p>
</li>
<li>
<p><strong>Site resolution rules</strong><br>
The site resolution rules ensure that Magnolia can properly assign a
site for a given request. The Multisite module comes with a standard set
of site resolution rules. The standard rules usually are sufficient. We
strongly recommend you be careful if you choose to change these rules.<br>
When a request is sent to Magnolia, MultiSiteFilter analyses the request
to determine which site definition it fits. Once the site has been
determined, it is set to the AggregationState from where it can be read
during further request processing.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="src-196596675_HowtouseMultisite-Settingupmultisite-mainsteps"><a class="anchor" href="#src-196596675_HowtouseMultisite-Settingupmultisite-mainsteps"></a>Setting up multisite - main steps</h4>
<div class="paragraph">
<p>The following bullet points summarize what you need to do to set up a
multisite environment with one Magnolia installation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create trees or subtrees of JCR nodes (usually pages) with different
purposes.</p>
</li>
<li>
<p>Configure site definitions. For each one, define:</p>
<div class="ulist">
<ul>
<li>
<p>A mapping pointing to the tree or subtree of JCR nodes (usually
pages).</p>
</li>
<li>
<p>A domain mapping to map a domain to the site.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Access the distinct content (sub)trees via distinct domains.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>When the Multisite module is enabled, you must configure at least one
site definition including a proper domain mapping. If you do not do so,
pages are not served correctly on the public instance.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Magnoliasetupanddomainsinaproductionenvironment"><a class="anchor" href="#src-196596675_HowtouseMultisite-Magnoliasetupanddomainsinaproductionenvironment"></a>Magnolia setup and domains in a production environment</h3>
<div class="paragraph">
<p>Magnolia is distributed as two web-applications: author and public.
Among other things, editors create pages on the author instance and
publish content from the author instance to public instances. Public
instances serve the content to visitors. In a typical production setup
you have one author and several public
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Instances">Instances</a>.</p>
</div>
<div class="paragraph">
<p>In a production setup, the author instance and public instance are
typically accessed via distinct domains.</p>
</div>
<div class="paragraph">
<p>Best practice</p>
</div>
<div class="paragraph">
<p>In a multisite setup with one Magnolia installation, you assign multiple
domains to the public instance. However, it is sufficient and
recommended to have only one domain pointing to your author instance.
The domain of the author instance is different from the domains of the
public instance.</p>
</div>
<div class="sect3">
<h4 id="src-196596675_HowtouseMultisite-Exampleofdomainsinaproductionenvironment"><a class="anchor" href="#src-196596675_HowtouseMultisite-Exampleofdomainsinaproductionenvironment"></a>Example of domains in a production environment</h4>
<div class="paragraph">
<p>This table shows the difference between domains when pointing to author
or public instances in a production environment.</p>
</div>
<div class="paragraph">
<p>author instance</p>
</div>
<div class="paragraph">
<p>public instance</p>
</div>
<div class="paragraph">
<p><em>Distinct sites</em></p>
</div>
<div class="paragraph">
<p>site a</p>
</div>
<div class="paragraph">
<p>author.yourdomain.net</p>
</div>
<div class="paragraph">
<p>www.yourdomain.net</p>
</div>
<div class="paragraph">
<p>site b</p>
</div>
<div class="paragraph">
<p>www.another-domain.net</p>
</div>
<div class="paragraph">
<p><em>Subsidiaries or localized sites</em></p>
</div>
<div class="paragraph">
<p>Main site</p>
</div>
<div class="paragraph">
<p>author.xyzdomain.com</p>
</div>
<div class="paragraph">
<p>www.xyzdomain.com</p>
</div>
<div class="paragraph">
<p>German country site</p>
</div>
<div class="paragraph">
<p>www.xyzdomain.de</p>
</div>
<div class="paragraph">
<p>French country site</p>
</div>
<div class="paragraph">
<p>www.xyzdomain.fr</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-Servingthewebappsfromrootcontext"><a class="anchor" href="#src-196596675_HowtouseMultisite-Servingthewebappsfromrootcontext"></a>Serving the webapps from root context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a production environment, you access the public instance by
requesting the root path of the domain. For example, when you request
<a href="http://www.yourdomain.net" class="bare">http://www.yourdomain.net</a>.[www.yourdomain.net] you expect it to serve
the webapp typically called magnoliaPublic. The same is true for the
author instance: you expect
<a href="http://author.yourdomain.net">author.yourdomain.net</a> to serve the webapp
called magnoliaAuthor.</p>
</div>
<div class="paragraph">
<p>If you run a bundle on localhost, you request the public instance using
<a href="http://localhost:8080/magnoliaPublic" class="bare">http://localhost:8080/magnoliaPublic</a>. In this case, the webapp
magnoliaPublic is served from <code>/magnoliaPublic</code>.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>In a production environment, serve the webapps from the root context
instead.</p>
</div>
<div class="paragraph">
<p>Application servers such as Tomcat generally only serve one webapp from
root context within the same connector. However, in a production
environment, you typically run the author instance and the public
instance in different networks. Alternatively, you may run two Tomcat
instances on the same host, or run one Tomcat instance with two
connectors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-Mappingmultipledomainstotheapplicationserver"><a class="anchor" href="#src-196596675_HowtouseMultisite-Mappingmultipledomainstotheapplicationserver"></a>Mapping multiple domains to the application server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a production environment, you typically use a web server such as
<a href="http://httpd.apache.org">Apache</a> in front of Tomcat. Read
<a href="https://wiki.magnolia-cms.com/display/WIKI/Apache+httpd+in+front+of+Tomcat+on+a+local+dev+machine">Apache
httpd in front of Tomcat</a> to get some ideas about such a setup. When
using the Apache HTTP Server (Apache httpd) and Apache Tomcat together,
<code>mod_jk</code> or <code>mod_proxy_ajp</code> can be used to redirect from Apache httpd to
Tomcat.</p>
</div>
<div class="paragraph">
<p>In a multisite setup, where your public context serves content for
multiple domains, you must map multiple domains to your application
server (such as Tomcat). If you use a web server in front of the
application, you must define multiple virtual hosts on the web server to
redirect the request from Apache http to Apache Tomcat.</p>
</div>
<div class="paragraph">
<p>Click here to expand to see an example of virtual hosts setup</p>
</div>
<div class="paragraph">
<p><code>&lt;VirtualHost *:80&gt;</code></p>
</div>
<div class="paragraph">
<p>` ServerName www.best-comics.net`</p>
</div>
<div class="paragraph">
<p>` ProxyPass / ajp:<code>//localhost</code>:8010/`</p>
</div>
<div class="paragraph">
<p>` ProxyPassReverse / ajp:<code>//localhost</code>:8010/`</p>
</div>
<div class="paragraph">
<p><code>&lt;<code>/VirtualHost</code>&gt;</code></p>
</div>
<div class="paragraph">
<p>` `</p>
</div>
<div class="paragraph">
<p><code>&lt;VirtualHost *:80&gt;</code></p>
</div>
<div class="paragraph">
<p>` ServerName www.best-vinyl.net`</p>
</div>
<div class="paragraph">
<p>` ProxyPass / ajp:<code>//localhost</code>:8010/`</p>
</div>
<div class="paragraph">
<p>` ProxyPassReverse / ajp:<code>//localhost</code>:8010/`</p>
</div>
<div class="paragraph">
<p><code>&lt;<code>/VirtualHost</code>&gt;</code></p>
</div>
<div class="paragraph">
<p>In this example, the Apache modules <code>proxy_ajp_module</code> and
<code>proxy_module</code> are used to redirect the request to Apache Tomcat using
the <a href="https://en.wikipedia.org/wiki/Apache_JServ_Protocol">Apache JServ
Protocol</a> (AJP). The example shows two virtual hosts both redirecting to
the same Magnolia public instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-Fallbacksite"><a class="anchor" href="#src-196596675_HowtouseMultisite-Fallbacksite"></a>Fallback site</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The multisite module provides a <code>fallback</code> site. The fallback site is a
special site definition that is used when no site matches the request.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Do not delete or rename the fallback site.</p>
</div>
<div class="paragraph">
<p>When using multisite, it is common to have one main site and some
additional sites. It generally makes sense to adapt the fallback site so
that it extends your main site.</p>
</div>
<div class="paragraph">
<p>For example, the
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Demo">Magnolia Travel demo</a>
has two sites: <code>travel-demo</code> and <code>sportstation</code>. When the demo modules
are installed, the fallback site is changed to extend <code>travel-demo</code>
site.</p>
</div>
<div class="paragraph">
<p>Without the demo modules, the configuration of the fallback site looks
like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fallback</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mappings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">override</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domains</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">override</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-Configuration"><a class="anchor" href="#src-196596675_HowtouseMultisite-Configuration"></a>Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section is about site definition configuration in the context of
multisite. It explains how to configure multiple, distinct site
definitions which require the definition of <code>domains</code> and <code>mappings</code>
nodes.</p>
</div>
<div class="paragraph">
<p>We assume that you already know some basics about Magnolia
<a href="Site_definition.html">site definition</a> configuration (such as
prototypes, themes, imaging variations and <code>sitefn</code> templating
functions).</p>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Siteapp"><a class="anchor" href="#src-196596675_HowtouseMultisite-Siteapp"></a>Site app</h3>
<div class="paragraph">
<p>Go to the <a href="https://wiki.magnolia-cms.com/display/DOCS62/Site+app">Site
app</a> to configure a site definition.</p>
</div>
<div class="paragraph">
<p>If your bundle contains the Multisite module, the Site app shows the
node <code>/modules/multisite/config/sites</code> from the configuration workspace.</p>
</div>
<div class="paragraph">
<p>When you open the Site app you see all configured sites as top-level
nodes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fallback</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comics-site</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example there are two sites: <code>fallback</code> and
<code>comics-site</code>.[<mark>src-196596675_HowtouseMultisite-site-definition-name]</mark>#</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Sitedefinitionname"><a class="anchor" href="#src-196596675_HowtouseMultisite-Sitedefinitionname"></a>Site definition name</h3>
<div class="paragraph">
<p>The node name of the site definition is called <code>site-definition-name</code> .</p>
</div>
<div class="paragraph">
<p>If a site is properly configured, it can be accessed using the following
URL:</p>
</div>
<div class="paragraph">
<p><code>&lt;protocol&gt;://&lt;domain&gt;:&lt;port&gt;/&lt;context&gt;/&lt;site-definition-name&gt;</code></p>
</div>
<div class="paragraph">
<p>Note that this only works if the <em>domain</em> part of the URL is different
from the domain that is mapped to the site of the given
<code>site-definition-name</code> .</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Mappingsanddomains"><a class="anchor" href="#src-196596675_HowtouseMultisite-Mappingsanddomains"></a>Mappings and domains</h3>
<div class="paragraph">
<p>The <code>mappings</code> and <code>domains</code> nodes are required in a multisite context.
You must create a least one entry on both mappings and domains to ensure
a proper site definition for a distinct site.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comics-site</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mappings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">website</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URIPrefix</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handlePrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/comics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">website</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jolly-jumper</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URIPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/jollyjumper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handlePrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/comics/belgian-comics/morris/lucky-luke/jolly-jumper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">website</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">best-comics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">www.best-comics.net</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>[<mark>src-196596675_HowtouseMultisite-jollyjumper]</mark>#</p>
</div>
<div class="paragraph">
<p>The site defined above allows you to access:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The content node <code>/comics</code> via the URL
<a href="http://www.best-comics.net">www.best-comics.net</a>.</p>
</li>
<li>
<p>The content node
<code>/comics/belgian-comics/morris/lucky-luke/jolly-jumper</code> via the URL
<a href="http://www.best-comics.net/jollyjumper">www.best-comics.net/jollyjumper</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Best practice</p>
</div>
<div class="paragraph">
<p>Use different values for the <code>site-definition-name</code> and the name of the
mapped node (<code>handlePrefix</code>).</p>
</div>
<div class="sect3">
<h4 id="src-196596675_HowtouseMultisite-mappingsconfiguration"><a class="anchor" href="#src-196596675_HowtouseMultisite-mappingsconfiguration"></a>mappings configuration</h4>
<div class="paragraph">
<p>The mapping nodes define the JCR content nodes (usually page nodes)
assigned to the site definition.</p>
</div>
<div class="paragraph">
<p>A mapping has the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;mapping-node&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>required</strong></p>
</div>
<div class="paragraph">
<p>Each site can contain multiple mappings. The name of a mapping node is
arbitrary. (In the example above, the node name is website.)</p>
</div>
<div class="paragraph">
<p>The corresponding java class for a mapping is URI2RepositoryMapping .</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repository</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>required</strong></p>
</div>
<div class="paragraph">
<p>Name of the JCR workspace the mapping applies to.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>handlePrefix</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>required</strong></p>
</div>
<div class="paragraph">
<p>The path in the workspace the content is served from.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>URIPrefix</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>required</strong></p>
</div>
<div class="paragraph">
<p>Creates a node handle based on a URI. By default, a content request that
does not contain a prefix is served from the node defined on
<code>handlePrefix</code> of the given repository.</p>
</div>
<div class="paragraph">
<p>The <code>URIPrefix</code> property can be used to shorten URLs. (See the
<code>jolly-jumper</code> <a href="#src-196596675_HowtouseMultisite-jollyjumper">example
above</a> and the
<a href="Multisite_example_-_Minisite_using_URL_prefix_and_domain.html#src-196596677_Multisiteexample-MinisiteusingURLprefixanddomain-short-URL-with-handle-prefix">Multisite
example - Shorten URL with handlePrefix</a> example.) Short URLs are easier
to remember, quicker to type, take less space in print ads, and are
ranked more favorably by search engines than content deep down in the
site hierarchy.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
If this property is not set, MultiSiteURI2RepositoryManager throws an
exception (leading to runtime exception and a server error 500). Add the
property with an empty value (or <code>/</code>) if you do not need it.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>Note that
<a href="https://wiki.magnolia-cms.com/display/DOCS62/URI+mapping">URIPrefix
configuration</a> can also be applied in modules independent from site
definitions.</p>
</div>
<div class="paragraph">
<p>Configuration in the site definition overrides the configuration in
<code>/server/URI2RepositoryMapping/mappings/&lt;workspace&gt;</code> , resulting in
site-specific definitions.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="src-196596675_HowtouseMultisite-domainsconfiguration"><a class="anchor" href="#src-196596675_HowtouseMultisite-domainsconfiguration"></a>domains configuration</h4>
<div class="paragraph">
<p>A domain node assigns a domain to the given site definition. It defines
how the above mapped content node(s) can be accessed by URL. You can map
multiples domain to the same site.</p>
</div>
<div class="paragraph">
<p>A domain mapping has the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;domain-node&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>required</strong></p>
</div>
<div class="paragraph">
<p>The name of a domain mapping node is arbitrary. You can apply multiple
domain nodes per site.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>required</strong></p>
</div>
<div class="paragraph">
<p>Domain name such as <a href="http://www.best-comics.net/">www.best-comics.net</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>optional</strong></p>
</div>
<div class="paragraph">
<p>Port represents the port the web application was deployed on.</p>
</div>
<div class="paragraph">
<p><em>Default</em> is 80.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>protocol</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>optional</strong></p>
</div>
<div class="paragraph">
<p>HTTP or HTTPS.</p>
</div>
<div class="paragraph">
<p><em>Default</em> is HTTP.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>context</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>optional</strong></p>
</div>
<div class="paragraph">
<p>The context path of the Magnolia instance webapp such as
<code>magnoliaAuthor</code> or <code>magnoliaPublic</code>.<br>
You do not need to set the context property if the webapp is served from
root context.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The optional properties <code>port</code>, <code>protocol</code> and <code>context</code> are only used
to build links between the pages of different sites. In a typical
production setup, where you serve the webapps from the root context on
different domains, you do not have to set <code>port</code> and <code>context</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Extendingsitedefinitions"><a class="anchor" href="#src-196596675_HowtouseMultisite-Extendingsitedefinitions"></a>Extending site definitions</h3>
<div class="paragraph">
<p>Another configuration strategy is to have one site definition for your
<code>main</code> site with a <a href="Template_prototype.html">template prototype</a> that
you can then reuse on other site definitions. This is a common
alternative to having multiple independent site definitions.</p>
</div>
<div class="paragraph">
<p>In the example below, <code>site-2 `and `site-3</code> inherit from <code>site-1</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">site-1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">site-2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">../site-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">site-3</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">../site-1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><span class="image"><img src="../../_images/images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/<em>/images/icons/emoticons/warning.svg" alt="images/s/en_GB/8100/5084f018d64a97dc638ca9a178856f851ea353ff/</em>/images/icons/emoticons/warning.svg"></span>
Inheriting <code>mappings</code> and <code>domain</code> can lead to unexpected results and
may destroy your site setup.</p>
</div>
<div class="paragraph">
<p>Best practice</p>
</div>
<div class="paragraph">
<p>When extending site definitions, turn off inheritance for <code>mapping</code> and
<code>domains</code> by using @extends=override.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">site-1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">site-2</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">../site-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mappings</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">override</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domains</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">override</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-RemovingunwantedvirtualURIMappingonpubliccontext"><a class="anchor" href="#src-196596675_HowtouseMultisite-RemovingunwantedvirtualURIMappingonpubliccontext"></a>Removing unwanted virtualURIMapping on public context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Make sure you have no unwanted virtualURIMapping redirections on the
public context.</p>
</div>
<div class="paragraph">
<p>Use the
<a href="https://wiki.magnolia-cms.com/display/DOCS62/Configuration+app">Configuration
app</a> on the public context and search for <code>virtualURIMapping</code>. On a
standard Magnolia bundle you most probably find the node
<code>/modules/ui-admincentral/virtualURIMapping/default</code> which redirects to
<em>/.magnolia/admincentral</em>. You must delete the node to ensure a request
to <a href="http://&lt;your-domain&gt;/" class="bare">http://&lt;your-domain&gt;/</a> really serves the root page of your site. (For
further details look at the
<a href="Multisite_example_-_Two_sites_with_different_domains.html#src-196596681_Multisiteexample-Twositeswithdifferentdomains-remove-unwanted-virtualURIMapping-on-public-context">example</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-Siteresolutionrules"><a class="anchor" href="#src-196596675_HowtouseMultisite-Siteresolutionrules"></a>Site resolution rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The site resolution rules ensure that Magnolia can properly assign a
site for a given request. The Multisite module comes with a standard set
of site resolution rules. The standard rules usually are sufficient.</p>
</div>
<div class="paragraph">
<p>[.admonition-icon .confluence-information-macro-icon]##</p>
</div>
<div class="paragraph">
<p>If you change the site resolution rules, verify your changes on a test
system before making any changes to your production environment. Errors
in the site resolution rules can break your site.</p>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Ruleconfiguration"><a class="anchor" href="#src-196596675_HowtouseMultisite-Ruleconfiguration"></a>Rule configuration</h3>
<div class="paragraph">
<p>The multisite site resolution rules are configured below the node
<code>/modules/multisite/config/rules</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multisite</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uri-starts-with-sitename</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-and-uri-prefix-not-empty</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-and-handle-not-empty</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain-and-site-uri-prefix-empty</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uri-prefix-not-empty</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handle-not-empty</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that every rule contains one or more configured <code>Matcher</code> classes.</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-uri-starts-with-sitename"><a class="anchor" href="#src-196596675_HowtouseMultisite-uri-starts-with-sitename"></a><span id="src-196596675_HowtouseMultisite-uri-starts-with-sitename2 " class="confluence-anchor-link">#</span>#</h3>

</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Disablingtheuri-starts-with-sitenameruleonthepublicinstance"><a class="anchor" href="#src-196596675_HowtouseMultisite-Disablingtheuri-starts-with-sitenameruleonthepublicinstance"></a>Disabling the uri-starts-with-sitename rule on the public instance</h3>
<div class="paragraph">
<p>The <code>uri-starts-with-sitename</code> rule is a cross-site-evaluation rule that
enables you to access a site using its site-definition-name from another
domain. This is desired and required on the author instance, which
typically runs on a domain different from the domain(s) mapped to a site
definition(s).</p>
</div>
<div class="paragraph">
<p>If you have two site definitions, this rule allows you to access site A
from the domain which is mapped to site B. This is typically <em>not</em>
desired on a public instance.</p>
</div>
<div class="paragraph">
<p>Best practice</p>
</div>
<div class="paragraph">
<p>Disable the <code>uri-starts-with-sitename</code> rule in the public context.</p>
</div>
<div class="paragraph">
<p>Add an additional voter AdminOnlyMatcher to the rule. This way you can
use the same configuration on both the author and public instances.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Node name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rules</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uri-starts-with-sitename</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">matchers</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.magnolia.multisite.sites.matchers.SiteNameMatcher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.magnolia.multisite.sites.matchers.AdminOnlyMatcher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multipleMatchesPossible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Matcher <code>0</code> is set by default in the <code>uri-starts-with-sitename</code> rule.
Add AdminOnlyMatcher as a second matcher to ensure the rule is applied
in the author instance only.</p>
</div>
</div>
<div class="sect2">
<h3 id="src-196596675_HowtouseMultisite-Customsiteresolutionrulesandmatcherclasses"><a class="anchor" href="#src-196596675_HowtouseMultisite-Customsiteresolutionrulesandmatcherclasses"></a>Custom site resolution rules and matcher classes</h3>
<div class="paragraph">
<p>You can write your own custom matcher classes to create new rules. The
custom class should extend AbstractMatcher , which implements the
RequestMatcher interface.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="src-196596675_HowtouseMultisite-Examples"><a class="anchor" href="#src-196596675_HowtouseMultisite-Examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand multisite setup in different use cases, look at the
following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="Multisite_example_-_Two_sites_with_different_domains.html">Two
sites with different domains</a></p>
</li>
<li>
<p><a href="Multisite_example_-_Minisite_using_URL_prefix_and_domain.html">Minisite
using URL prefix and domain</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How to create a site definition</p>
</div>
<div class="paragraph">
<p>Multisite example - Minisite using URL prefix and domain</p>
</div>
<div class="paragraph">
<p><a href="#" class="bare">#</a></p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.magnolia-cms.com" class="icon">
            <img src="../../../_/img/magnolia-medium.png" alt="Magnolia">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://documentation.magnolia-cms.com" target="_blank" rel="noopener">Full Docs Set</a></li>
          <li><a href="https://wiki.magnolia-cms.com/" target="_blank" rel="noopener">Community Wiki</a></li>
          <li><a href="https://support.magnolia-cms.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://marketplace.magnolia-cms.com/" target="_blank" rel="noopener">Extend Magnolia</a></li>
          <li><a href="https://magnolia-cms.com/blog" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.magnolia-cms.com/training" target="_blank" >Training</a></li>
        </ul>
      </div>
      <div class="col">
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Magnolia" target="_blank" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/magnolia_cms" target="_blank" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/magnolia-cms" target="_blank" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2020 Magnolia International Ltd. All rights reserved.</span>
      <a href="https://www.magnolia-cms.com/legal/privacy.html">Privacy Policy</a>
    </div>
  </div>
</footer>

<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
